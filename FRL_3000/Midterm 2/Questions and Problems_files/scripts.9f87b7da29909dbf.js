(function(q,se){"function"==typeof define&&define.amd?define(q):typeof module<"u"&&"object"==typeof exports?module.exports=q():se.rangy=q()})(function(){var q="object",se="function",K="undefined",J=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],g=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],H=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],pe=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function $(h,I){var b=typeof h[I];return b==se||!(b!=q||!h[I])||"unknown"==b}function Re(h,I){return!(typeof h[I]!=q||!h[I])}function z(h,I){return typeof h[I]!=K}function Te(h){return function(I,b){for(var V=b.length;V--;)if(!h(I,b[V]))return!1;return!0}}var k=Te($),y=Te(Re),U=Te(z);function ne(h){return h&&k(h,pe)&&U(h,H)}function ee(h){return Re(h,"body")?h.body:h.getElementsByTagName("body")[0]}var a,E,Se={},ye=typeof window!=K&&typeof document!=K,le={isHostMethod:$,isHostObject:Re,isHostProperty:z,areHostMethods:k,areHostObjects:y,areHostProperties:U,isTextRange:ne,getBody:ee,forEach:[].forEach?function(h,I){h.forEach(I)}:function(h,I){for(var b=0,V=h.length;b<V;++b)I(h[b],b)}},S={version:"1.3.1-dev",initialized:!1,isBrowser:ye,supported:!0,util:le,features:{},modules:Se,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==K||rangyAutoInitialize}};function c(h){typeof console!=K&&$(console,"log")&&console.log(h)}function l(h,I){ye&&I?alert(h):c(h)}function m(h){S.initialized=!0,S.supported=!1,l("Rangy is not supported in this environment. Reason: "+h,S.config.alertOnFail)}S.fail=m,S.warn=function C(h){l("Rangy warning: "+h,S.config.alertOnWarn)},{}.hasOwnProperty?(le.extend=a=function(h,I,b){var V,Y;for(var fe in I)I.hasOwnProperty(fe)&&(V=h[fe],Y=I[fe],b&&null!==V&&"object"==typeof V&&null!==Y&&"object"==typeof Y&&a(V,Y,!0),h[fe]=Y);return I.hasOwnProperty("toString")&&(h.toString=I.toString),h},le.createOptions=function(h,I){var b={};return a(b,I),h&&a(b,h),b}):m("hasOwnProperty not supported"),ye||m("Rangy can only run in a browser"),function(){var h;if(ye){var I=document.createElement("div");I.appendChild(document.createElement("span"));var b=[].slice;try{I.childNodes.length&&1==b.call(I.childNodes,0)[0].nodeType&&(h=function(V){return b.call(V,0)})}catch{}}h||(h=function(V){for(var Y=[],fe=0,oe=V.length;fe<oe;++fe)Y[fe]=V[fe];return Y}),le.toArray=h}(),ye&&($(document,"addEventListener")?E=function(h,I,b){h.addEventListener(I,b,!1)}:$(document,"attachEvent")?E=function(h,I,b){h.attachEvent("on"+I,b)}:m("Document does not have required addEventListener or attachEvent method"),le.addListener=E);var p=[];function A(h){return h.message||h.description||String(h)}function s(){if(ye&&!S.initialized){var h,I=!1,b=!1;$(document,"createRange")&&(h=document.createRange(),k(h,g)&&U(h,J)&&(I=!0));var Y,V=ee(document);if(!V||"body"!=V.nodeName.toLowerCase())return void m("No body element found");if(V&&$(V,"createTextRange")&&ne(h=V.createTextRange())&&(b=!0),!I&&!b)return void m("Neither Range nor TextRange are available");for(var oe in S.initialized=!0,S.features={implementsDomRange:I,implementsTextRange:b},Se)(Y=Se[oe])instanceof Pe&&Y.init(Y,S);for(var Ae=0,Fe=p.length;Ae<Fe;++Ae)try{p[Ae](S)}catch(He){c("Rangy init listener threw an exception. Continuing. Detail: "+A(He))}}}function P(h,I,b){b&&(h+=" in module "+b.name),S.warn("DEPRECATED: "+h+" is deprecated. Please use "+I+" instead.")}function O(h,I,b,V){h[I]=function(){return P(I,b,V),h[b].apply(h,le.toArray(arguments))}}le.deprecationNotice=P,le.createAliasForDeprecatedMethod=O,S.init=s,S.addInitListener=function(h){S.initialized?h(S):p.push(h)};var D=[];function Pe(h,I,b){this.name=h,this.dependencies=I,this.initialized=!1,this.supported=!1,this.initializer=b}function De(h,I,b){var V=new Pe(h,I,function(Y){if(!Y.initialized){Y.initialized=!0;try{b(S,Y),Y.supported=!0}catch(oe){c("Module '"+h+"' failed to load: "+A(oe)),oe.stack&&c(oe.stack)}}});return Se[h]=V,V}function Je(){}S.addShimListener=function(h){D.push(h)},ye&&(S.shim=S.createMissingNativeApi=function X(h){h=h||window,s();for(var I=0,b=D.length;I<b;++I)D[I](h)},O(S,"createMissingNativeApi","shim")),Pe.prototype={init:function(){for(var V,Y,h=this.dependencies||[],I=0,b=h.length;I<b;++I){if(!((V=Se[Y=h[I]])&&V instanceof Pe))throw new Error("required module '"+Y+"' not found");if(V.init(),!V.supported)throw new Error("required module '"+Y+"' not supported")}this.initializer(this)},fail:function(h){throw this.initialized=!0,this.supported=!1,new Error(h)},warn:function(h){S.warn("Module "+this.name+": "+h)},deprecationNotice:function(h,I){S.warn("DEPRECATED: "+h+" in module "+this.name+" is deprecated. Please use "+I+" instead")},createError:function(h){return new Error("Error in Rangy "+this.name+" module: "+h)}},S.createModule=function(h){var I,b;2==arguments.length?(I=arguments[1],b=[]):(I=arguments[2],b=arguments[1]);var V=De(h,b,I);S.initialized&&S.supported&&V.init()},S.createCoreModule=function(h,I,b){De(h,I,b)},S.RangePrototype=Je,S.rangePrototype=new Je,S.selectionPrototype=new function tt(){},S.createCoreModule("DomUtil",[],function(h,I){var b="undefined",V=h.util,Y=V.getBody;V.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||I.fail("document missing a Node creation method"),V.isHostMethod(document,"getElementsByTagName")||I.fail("document missing getElementsByTagName method");var fe=document.createElement("div");V.areHostMethods(fe,["insertBefore","appendChild","cloneNode"])||I.fail("Incomplete Element implementation"),V.isHostProperty(fe,"innerHTML")||I.fail("Element is missing innerHTML property");var oe=document.createTextNode("test");V.areHostMethods(oe,["splitText","deleteData","insertData","appendData","cloneNode"])||I.fail("Incomplete Text Node implementation");var Ae=function(v,L){for(var ue=v.length;ue--;)if(v[ue]===L)return!0;return!1};function we(v){for(var L=0;v=v.previousSibling;)++L;return L}function We(v,L){var ie,ue=[];for(ie=v;ie;ie=ie.parentNode)ue.push(ie);for(ie=L;ie;ie=ie.parentNode)if(Ae(ue,ie))return ie;return null}function n(v,L,ue){for(var ie=ue?L:L.parentNode;ie;){if(ie===v)return!0;ie=ie.parentNode}return!1}function f(v,L,ue){for(var ie,Ie=ue?v:v.parentNode;Ie;){if((ie=Ie.parentNode)===L)return Ie;Ie=ie}return null}function N(v){if(!v)return!1;var L=v.nodeType;return 3==L||4==L||8==L}function w(v,L){var ue=L.nextSibling,ie=L.parentNode;return ue?ie.insertBefore(v,ue):ie.appendChild(v),v}function _(v){if(!v)throw I.createError("getDocument: no document found for node");if(9==v.nodeType)return v;if(typeof v.ownerDocument!=b)return v.ownerDocument;if(typeof v.document!=b)return v.document;if(v.parentNode)return _(v.parentNode);throw I.createError("getDocument: no document found for node")}function Z(v){var L=_(v);if(typeof L.defaultView!=b)return L.defaultView;if(typeof L.parentWindow!=b)return L.parentWindow;throw I.createError("Cannot get a window object for node")}function te(v){if(typeof v.contentDocument!=b)return v.contentDocument;if(typeof v.contentWindow!=b)return v.contentWindow.document;throw I.createError("getIframeDocument: No Document object found for iframe element")}function de(v){return v&&V.isHostMethod(v,"setTimeout")&&V.isHostObject(v,"document")}var _e,W=!1;function re(v){try{return!1}catch{return!0}}function Ee(v){return v?W&&re()?"[Broken node]":N(v)?'"'+v.data+'"':v&&1==v.nodeType?"<"+v.nodeName+(v.id?' id="'+v.id+'"':"")+">[index:"+we(v)+",length:"+v.childNodes.length+"]["+(v.innerHTML||"[innerHTML not supported]").slice(0,25)+"]":v.nodeName:"[No node]"}function Me(v){this.root=v,this._next=v}function Le(v,L){this.node=v,this.offset=L}function it(v){this.code=this[v],this.codeName=v,this.message="DOMException: "+this.codeName}!function(){var v=document.createElement("b");v.innerHTML="1";v.innerHTML="<br />",W=re(),h.features.crashyTextNodes=W}(),typeof window.getComputedStyle!=b?_e=function(v,L){return Z(v).getComputedStyle(v,null)[L]}:typeof document.documentElement.currentStyle!=b?_e=function(v,L){return v.currentStyle?v.currentStyle[L]:""}:I.fail("No means of obtaining computed style properties found"),Me.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var L,ue,v=this._current=this._next;if(this._current)if(L=v.firstChild)this._next=L;else{for(ue=null;v!==this.root&&!(ue=v.nextSibling);)v=v.parentNode;this._next=ue}return this._current},detach:function(){this._current=this._next=this.root=null}},Le.prototype={equals:function(v){return!!v&&this.node===v.node&&this.offset==v.offset},inspect:function(){return"[DomPosition("+Ee(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},(it.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24}).toString=function(){return this.message},h.dom={arrayContains:Ae,isHtmlNamespace:function Fe(v){var L;return typeof v.namespaceURI==b||null===(L=v.namespaceURI)||"http://www.w3.org/1999/xhtml"==L},parentElement:function He(v){var L=v.parentNode;return L&&1==L.nodeType?L:null},getNodeIndex:we,getNodeLength:function Be(v){if(!v)return 0;switch(v.nodeType){case 7:case 10:return 0;case 3:case 8:return v.length;default:return v.childNodes.length}},getCommonAncestor:We,isAncestorOf:n,isOrIsAncestorOf:function r(v,L){return n(v,L,!0)},getClosestAncestorIn:f,isCharacterDataNode:N,isTextOrCommentNode:function o(v){if(!v)return!1;var L=v.nodeType;return 3==L||8==L},insertAfter:w,splitDataNode:function R(v,L,ue){var ie=v.cloneNode(!1);if(ie.deleteData(0,L),v.deleteData(L,v.length-L),w(ie,v),ue)for(var Oe,Ie=0;Oe=ue[Ie++];)Oe.node==v&&Oe.offset>L?(Oe.node=ie,Oe.offset-=L):Oe.node==v.parentNode&&Oe.offset>we(v)&&++Oe.offset;return ie},getDocument:_,getWindow:Z,getIframeWindow:function F(v){if(typeof v.contentWindow!=b)return v.contentWindow;if(typeof v.contentDocument!=b)return v.contentDocument.defaultView;throw I.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:te,getBody:Y,isWindow:de,getContentDocument:function Ne(v,L,ue){var ie;if(v?V.isHostProperty(v,"nodeType")?ie=v&&1==v.nodeType&&"iframe"==v.tagName.toLowerCase()?te(v):_(v):de(v)&&(ie=v.document):ie=document,!ie)throw L.createError(ue+"(): Parameter must be a Window object or DOM node");return ie},getRootContainer:function ge(v){for(var L;L=v.parentNode;)v=L;return v},comparePoints:function Ue(v,L,ue,ie){var Ie,Oe,ze,st,$e;if(v==ue)return L===ie?0:L<ie?-1:1;if(Ie=f(ue,v,!0))return L<=we(Ie)?-1:1;if(Ie=f(v,ue,!0))return we(Ie)<ie?-1:1;if(!(Oe=We(v,ue)))throw new Error("comparePoints error: nodes have no common ancestor");if((ze=v===Oe?Oe:f(v,Oe,!0))===(st=ue===Oe?Oe:f(ue,Oe,!0)))throw I.createError("comparePoints got to case 4 and childA and childB are the same!");for($e=Oe.firstChild;$e;){if($e===ze)return-1;if($e===st)return 1;$e=$e.nextSibling}},isBrokenNode:re,inspectNode:Ee,getComputedStyleProperty:_e,createTestElement:function nt(v,L,ue){var ie=Y(v),Ie=v.createElement("div");Ie.contentEditable=""+!!ue,L&&(Ie.innerHTML=L);var Oe=ie.firstChild;return Oe?ie.insertBefore(Ie,Oe):ie.appendChild(Ie),Ie},removeNode:function Ve(v){return v.parentNode.removeChild(v)},fragmentFromNodeChildren:function be(v){for(var ue,L=_(v).createDocumentFragment();ue=v.firstChild;)L.appendChild(ue);return L},createIterator:function rt(v){return new Me(v)},DomPosition:Le},h.DOMException=it}),S.createCoreModule("DomRange",["DomUtil"],function(h,I){var b=h.dom,V=h.util,Y=b.DomPosition,fe=h.DOMException,oe=b.isCharacterDataNode,Ae=b.getNodeIndex,Fe=b.isOrIsAncestorOf,He=b.getDocument,we=b.comparePoints,Be=b.splitDataNode,We=b.getClosestAncestorIn,n=b.getNodeLength,r=b.arrayContains,f=b.getRootContainer,N=h.features.crashyTextNodes,o=b.removeNode;function w(e,u){return e&&3!=e.nodeType&&(Fe(e,u.startContainer)||Fe(e,u.endContainer))}function R(e){return e.document||He(e.startContainer)}function Z(e){return new Y(e.parentNode,Ae(e))}function te(e){return new Y(e.parentNode,Ae(e)+1)}function F(e,u,T){var B=e&&11==e.nodeType?e.firstChild:e;return oe(u)?T==u.length?b.insertAfter(e,u):u.parentNode.insertBefore(e,0==T?u:Be(u,T)):T>=u.childNodes.length?u.appendChild(e):u.insertBefore(e,u.childNodes[T]),B}function de(e,u,T){if(ke(e),ke(u),R(u)!=R(e))throw new fe("WRONG_DOCUMENT_ERR");var B=we(e.startContainer,e.startOffset,u.endContainer,u.endOffset),Q=we(e.endContainer,e.endOffset,u.startContainer,u.startOffset);return T?B<=0&&Q>=0:B<0&&Q>0}function Ne(e){for(var u,T,Q,B=R(e.range).createDocumentFragment();T=e.next();){if(u=e.isPartiallySelectedSubtree(),T=T.cloneNode(!u),u&&(Q=e.getSubtreeIterator(),T.appendChild(Ne(Q)),Q.detach()),T&&10==T.nodeType)throw new fe("HIERARCHY_REQUEST_ERR");B.appendChild(T)}return B}function ge(e,u,T){var B,Q,ve,M;for(T=T||{stop:!1};ve=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===u(ve))return void(T.stop=!0);if(ge(M=e.getSubtreeIterator(),u,T),M.detach(),T.stop)return}else for(B=b.createIterator(ve);Q=B.next();)if(!1===u(Q))return void(T.stop=!0)}function Ue(e){for(var u;e.next();)e.isPartiallySelectedSubtree()?(Ue(u=e.getSubtreeIterator()),u.detach()):e.remove()}function W(e){for(var u,B,T=R(e.range).createDocumentFragment();u=e.next();){if(e.isPartiallySelectedSubtree()?(u=u.cloneNode(!1),B=e.getSubtreeIterator(),u.appendChild(W(B)),B.detach()):e.remove(),u&&10==u.nodeType)throw new fe("HIERARCHY_REQUEST_ERR");T.appendChild(u)}return T}function Ee(e){return"["+(typeof e.getName>"u"?"Range":e.getName())+"("+b.inspectNode(e.startContainer)+":"+e.startOffset+", "+b.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function be(e,u){if(this.range=e,this.clonePartiallySelectedTextNodes=u,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var T=e.commonAncestorContainer;this.sc===this.ec&&oe(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==T||oe(this.sc)?We(this.sc,T,!0):this.sc.childNodes[this.so],this._last=this.ec!==T||oe(this.ec)?We(this.ec,T,!0):this.ec.childNodes[this.eo-1])}}be.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,oe(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var u,T,e=this._current;!oe(e)||e!==this.sc&&e!==this.ec?e.parentNode&&o(e):(u=e===this.sc?this.so:0)!=(T=e===this.ec?this.eo:e.length)&&e.deleteData(u,T-u)},isPartiallySelectedSubtree:function(){return w(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new Ge(R(this.range));var u=this._current,T=u,B=0,Q=u,ve=n(u);Fe(u,this.sc)&&(T=this.sc,B=this.so),Fe(u,this.ec)&&(Q=this.ec,ve=this.eo),qe(e,T,B,Q,ve)}return new be(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var _e=[1,3,4,5,7,8,10],nt=[2,9,11],Me=[1,3,4,5,7,8,10,11],rt=[1,3,4,5,7,8];function Le(e){return function(u,T){if(!u)return null;for(var Q=T?u:u.parentNode;Q;){if(r(e,Q.nodeType))return Q;Q=Q.parentNode}return null}}var it=Le([9,11]),v=Le([5,6,10,12]),L=Le([6,10,12]);function ue(e,u){if(L(e,u))throw new fe("INVALID_NODE_TYPE_ERR")}function ie(e,u){if(!e||!r(u,e.nodeType))throw new fe("INVALID_NODE_TYPE_ERR")}function Ie(e,u){if(u<0||u>(oe(e)?e.length:e.childNodes.length))throw new fe("INDEX_SIZE_ERR")}function Oe(e,u){if(it(e,!0)!==it(u,!0))throw new fe("WRONG_DOCUMENT_ERR")}function ze(e){if(v(e,!0))throw new fe("NO_MODIFICATION_ALLOWED_ERR")}function st(e,u){if(!e)throw new fe(u)}function $e(e,u){return u<=(oe(e)?e.length:e.childNodes.length)}function Ke(e){return!!e.startContainer&&!!e.endContainer&&!(N&&(b.isBrokenNode(e.startContainer)||b.isBrokenNode(e.endContainer)))&&f(e.startContainer)==f(e.endContainer)&&$e(e.startContainer,e.startOffset)&&$e(e.endContainer,e.endOffset)}function ke(e){if(!Ke(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var ot=document.createElement("style"),ft=!1;try{ot.innerHTML="<b>x</b>",ft=3==ot.firstChild.nodeType}catch{}function he(e,u){ke(e);var T=e.startContainer,B=e.startOffset,Q=e.endContainer,ve=e.endOffset,M=T===Q;oe(Q)&&ve>0&&ve<Q.length&&Be(Q,ve,u),oe(T)&&B>0&&B<T.length&&(T=Be(T,B,u),M?(ve-=B,Q=T):Q==T.parentNode&&ve>=Ae(T)&&ve++,B=0),e.setStartAndEnd(T,B,Q,ve)}function dt(e){ke(e);var u=e.commonAncestorContainer.parentNode.cloneNode(!1);return u.appendChild(e.cloneContents()),u.innerHTML}h.features.htmlParsingConforms=ft;var ut=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],lt=0,gt=1,ct=2,pt=3,vt=0,mt=1,t=2,d=3;function x(e){e.START_TO_START=lt,e.START_TO_END=gt,e.END_TO_END=ct,e.END_TO_START=pt,e.NODE_BEFORE=vt,e.NODE_AFTER=mt,e.NODE_BEFORE_AND_AFTER=t,e.NODE_INSIDE=d}function j(e){x(e),x(e.prototype)}function ce(e,u){return function(){ke(this);var G,T=this.startContainer,B=this.startOffset,Q=this.commonAncestorContainer,ve=new be(this,!0);T!==Q&&(T=(G=te(We(T,Q,!0))).node,B=G.offset),ge(ve,ze),ve.reset();var ae=e(ve);return ve.detach(),u(this,T,B,T,B),ae}}function xe(e,u){function T(M,G){return function(ae){ie(ae,_e),ie(f(ae),nt);var me=(M?Z:te)(ae);(G?B:Q)(this,me.node,me.offset)}}function B(M,G,ae){var me=M.endContainer,Ye=M.endOffset;(G!==M.startContainer||ae!==M.startOffset)&&((f(G)!=f(me)||1==we(G,ae,me,Ye))&&(me=G,Ye=ae),u(M,G,ae,me,Ye))}function Q(M,G,ae){var me=M.startContainer,Ye=M.startOffset;(G!==M.endContainer||ae!==M.endOffset)&&((f(G)!=f(me)||-1==we(G,ae,me,Ye))&&(me=G,Ye=ae),u(M,me,Ye,G,ae))}var ve=function(){};ve.prototype=h.rangePrototype,e.prototype=new ve,V.extend(e.prototype,{setStart:function(M,G){ue(M,!0),Ie(M,G),B(this,M,G)},setEnd:function(M,G){ue(M,!0),Ie(M,G),Q(this,M,G)},setStartAndEnd:function(){var M=arguments,G=M[0],ae=M[1],me=G,Ye=ae;switch(M.length){case 3:Ye=M[2];break;case 4:me=M[2],Ye=M[3]}u(this,G,ae,me,Ye)},setBoundary:function(M,G,ae){this["set"+(ae?"Start":"End")](M,G)},setStartBefore:T(!0,!0),setStartAfter:T(!1,!0),setEndBefore:T(!0,!1),setEndAfter:T(!1,!1),collapse:function(M){ke(this),M?u(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):u(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(M){ue(M,!0),u(this,M,0,M,n(M))},selectNode:function(M){ue(M,!1),ie(M,_e);var G=Z(M),ae=te(M);u(this,G.node,G.offset,ae.node,ae.offset)},extractContents:ce(W,u),deleteContents:ce(Ue,u),canSurroundContents:function(){ke(this),ze(this.startContainer),ze(this.endContainer);var M=new be(this,!0),G=M._first&&w(M._first,this)||M._last&&w(M._last,this);return M.detach(),!G},splitBoundaries:function(){he(this)},splitBoundariesPreservingPositions:function(M){he(this,M)},normalizeBoundaries:function(){ke(this);var et,M=this.startContainer,G=this.startOffset,ae=this.endContainer,me=this.endOffset,Ye=function(Qe){var at=Qe.nextSibling;at&&at.nodeType==Qe.nodeType&&(ae=Qe,me=Qe.length,Qe.appendData(at.data),o(at))},Et=function(Qe){var at=Qe.previousSibling;if(at&&at.nodeType==Qe.nodeType){M=Qe;var yt=Qe.length;if(G=at.length,Qe.insertData(0,at.data),o(at),M==ae)me+=G,ae=M;else if(ae==Qe.parentNode){var Rt=Ae(Qe);me==Rt?(ae=Qe,me=yt):me>Rt&&me--}}},Nt=!0;if(oe(ae))me==ae.length?Ye(ae):0==me&&(et=ae.previousSibling)&&et.nodeType==ae.nodeType&&(me=et.length,M==ae&&(Nt=!1),et.appendData(ae.data),o(ae),ae=et);else{if(me>0){var Ct=ae.childNodes[me-1];Ct&&oe(Ct)&&Ye(Ct)}Nt=!this.collapsed}if(Nt){if(oe(M))0==G?Et(M):G==M.length&&(et=M.nextSibling)&&M&&et.nodeType==M.nodeType&&(ae==et&&(ae=M,me+=M.length),M.appendData(et.data),o(et));else if(G<M.childNodes.length){var St=M.childNodes[G];St&&oe(St)&&Et(St)}}else M=ae,G=me;u(this,M,G,ae,me)},collapseToPoint:function(M,G){ue(M,!0),Ie(M,G),this.setStartAndEnd(M,G)}}),j(e)}function je(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:b.getCommonAncestor(e.startContainer,e.endContainer)}function qe(e,u,T,B,Q){e.startContainer=u,e.startOffset=T,e.endContainer=B,e.endOffset=Q,e.document=b.getDocument(u),je(e)}function Ge(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,je(this)}V.extend(h.rangePrototype,{compareBoundaryPoints:function(e,u){ke(this),Oe(this.startContainer,u.startContainer);var M=e==pt||e==lt?"start":"end",G=e==gt||e==lt?"start":"end";return we(this[M+"Container"],this[M+"Offset"],u[G+"Container"],u[G+"Offset"])},insertNode:function(e){if(ke(this),ie(e,Me),ze(this.startContainer),Fe(e,this.startContainer))throw new fe("HIERARCHY_REQUEST_ERR");var u=F(e,this.startContainer,this.startOffset);this.setStartBefore(u)},cloneContents:function(){var e,u;if(ke(this),this.collapsed)return R(this).createDocumentFragment();if(this.startContainer===this.endContainer&&oe(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(u=R(this).createDocumentFragment()).appendChild(e),u;var T=new be(this,!0);return e=Ne(T),T.detach(),e},canSurroundContents:function(){ke(this),ze(this.startContainer),ze(this.endContainer);var e=new be(this,!0),u=e._first&&w(e._first,this)||e._last&&w(e._last,this);return e.detach(),!u},surroundContents:function(e){if(ie(e,rt),!this.canSurroundContents())throw new fe("INVALID_STATE_ERR");var u=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);F(e,this.startContainer,this.startOffset),e.appendChild(u),this.selectNode(e)},cloneRange:function(){ke(this);for(var T,e=new Ge(R(this)),u=ut.length;u--;)e[T=ut[u]]=this[T];return e},toString:function(){ke(this);var e=this.startContainer;if(e===this.endContainer&&oe(e))return!e||3!=e.nodeType&&4!=e.nodeType?"":e.data.slice(this.startOffset,this.endOffset);var u=[],T=new be(this,!0);return ge(T,function(B){B&&(3==B.nodeType||4==B.nodeType)&&u.push(B.data)}),T.detach(),u.join("")},compareNode:function(e){ke(this);var u=e.parentNode,T=Ae(e);if(!u)throw new fe("NOT_FOUND_ERR");var B=this.comparePoint(u,T),Q=this.comparePoint(u,T+1);return B<0?Q>0?t:vt:Q>0?mt:d},comparePoint:function(e,u){return ke(this),st(e,"HIERARCHY_REQUEST_ERR"),Oe(e,this.startContainer),we(e,u,this.startContainer,this.startOffset)<0?-1:we(e,u,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ft?function(e){var u=this.startContainer,T=He(u);if(!u)throw new fe("INVALID_STATE_ERR");var B=null;return u&&1==u.nodeType?B=u:oe(u)&&(B=b.parentElement(u)),(B=null===B||"HTML"==B.nodeName&&b.isHtmlNamespace(He(B).documentElement)&&b.isHtmlNamespace(B)?T.createElement("body"):B.cloneNode(!1)).innerHTML=e,b.fragmentFromNodeChildren(B)}:function(e){var T=R(this).createElement("body");return T.innerHTML=e,b.fragmentFromNodeChildren(T)},toHtml:function(){return dt(this)},intersectsNode:function(e,u){if(ke(this),f(e)!=function _(e){return f(e.startContainer)}(this))return!1;var T=e.parentNode,B=Ae(e);if(!T)return!0;var Q=we(T,B,this.endContainer,this.endOffset),ve=we(T,B+1,this.startContainer,this.startOffset);return u?Q<=0&&ve>=0:Q<0&&ve>0},isPointInRange:function(e,u){return ke(this),st(e,"HIERARCHY_REQUEST_ERR"),Oe(e,this.startContainer),we(e,u,this.startContainer,this.startOffset)>=0&&we(e,u,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return de(this,e,!1)},intersectsOrTouchesRange:function(e){return de(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var u=we(this.startContainer,this.startOffset,e.startContainer,e.startOffset),T=we(this.endContainer,this.endOffset,e.endContainer,e.endOffset),B=this.cloneRange();return-1==u&&B.setStart(e.startContainer,e.startOffset),1==T&&B.setEnd(e.endContainer,e.endOffset),B}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var u=this.cloneRange();return-1==we(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&u.setStart(e.startContainer,e.startOffset),1==we(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&u.setEnd(e.endContainer,e.endOffset),u}throw new fe("Ranges do not intersect")},containsNode:function(e,u){return u?this.intersectsNode(e,!1):this.compareNode(e)==d},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,n(e))<=0},containsRange:function(e){var u=this.intersection(e);return null!==u&&e.equals(u)},containsNodeText:function(e){var u=this.cloneRange();u.selectNode(e);var T=u.getNodes([3]);if(T.length>0){u.setStart(T[0],0);var B=T.pop();return u.setEnd(B,B.length),this.containsRange(u)}return this.containsNodeContents(e)},getNodes:function(e,u){return ke(this),function re(e,u,T){var Q,B=!(!u||!u.length),ve=!!T;B&&(Q=new RegExp("^("+u.join("|")+")$"));var M=[];return ge(new be(e,!1),function(G){if((!B||!G||Q.test(G.nodeType))&&(!ve||T(G))){var ae=e.startContainer;if(G!=ae||!oe(ae)||e.startOffset!=ae.length){var me=e.endContainer;G==me&&oe(me)&&0==e.endOffset||M.push(G)}}}),M}(this,e,u)},getDocument:function(){return R(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(e){var u=R(this),T=h.createRange(u);e=e||b.getBody(u),T.selectNodeContents(e);var B=this.intersection(T),Q=0,ve=0;return B&&(T.setEnd(B.startContainer,B.startOffset),ve=(Q=T.toString().length)+B.toString().length),{start:Q,end:ve,containerNode:e}},moveToBookmark:function(e){var u=e.containerNode,T=0;this.setStart(u,0),this.collapse(!0);for(var Q,G,ae,me,B=[u],ve=!1,M=!1;!M&&(Q=B.pop());)if(Q&&3==Q.nodeType)G=T+Q.length,!ve&&e.start>=T&&e.start<=G&&(this.setStart(Q,e.start-T),ve=!0),ve&&e.end>=T&&e.end<=G&&(this.setEnd(Q,e.end-T),M=!0),T=G;else for(ae=(me=Q.childNodes).length;ae--;)B.push(me[ae])},getName:function(){return"DomRange"},equals:function(e){return Ge.rangesEqual(this,e)},isValid:function(){return Ke(this)},inspect:function(){return Ee(this)},detach:function(){}}),xe(Ge,qe),V.extend(Ge,{rangeProperties:ut,RangeIterator:be,copyComparisonConstants:j,createPrototypeRange:xe,inspect:Ee,toHtml:dt,getRangeDocument:R,rangesEqual:function(e,u){return e.startContainer===u.startContainer&&e.startOffset===u.startOffset&&e.endContainer===u.endContainer&&e.endOffset===u.endOffset}}),h.DomRange=Ge}),S.createCoreModule("WrappedRange",["DomRange"],function(h,I){var b,V,Y=h.dom,fe=h.util,oe=Y.DomPosition,Ae=h.DomRange,Fe=Y.getBody,He=Y.getContentDocument,we=Y.isCharacterDataNode;if(h.features.implementsDomRange&&function(){var o,Z,w=Ae.rangeProperties;function R(W){for(var Ee,re=w.length;re--;)W[Ee=w[re]]=W.nativeRange[Ee];W.collapsed=W.startContainer===W.endContainer&&W.startOffset===W.endOffset}Ae.createPrototypeRange(b=function(W){if(!W)throw I.createError("WrappedRange: Range must be specified");this.nativeRange=W,R(this)},function _(W,re,Ee,be,_e){var nt=W.startContainer!==re||W.startOffset!=Ee,Ve=W.endContainer!==be||W.endOffset!=_e,Me=!W.equals(W.nativeRange);(nt||Ve||Me)&&(W.setEnd(be,_e),W.setStart(re,Ee))}),(o=b.prototype).selectNode=function(W){this.nativeRange.selectNode(W),R(this)},o.cloneContents=function(){return this.nativeRange.cloneContents()},o.surroundContents=function(W){this.nativeRange.surroundContents(W),R(this)},o.collapse=function(W){this.nativeRange.collapse(W),R(this)},o.cloneRange=function(){return new b(this.nativeRange.cloneRange())},o.refresh=function(){R(this)},o.toString=function(){return this.nativeRange.toString()};var te=document.createTextNode("test");Fe(document).appendChild(te);var F=document.createRange();F.setStart(te,0),F.setEnd(te,0);try{F.setStart(te,1),o.setStart=function(W,re){this.nativeRange.setStart(W,re),R(this)},o.setEnd=function(W,re){this.nativeRange.setEnd(W,re),R(this)},Z=function(W){return function(re){this.nativeRange[W](re),R(this)}}}catch{o.setStart=function(re,Ee){try{this.nativeRange.setStart(re,Ee)}catch{this.nativeRange.setEnd(re,Ee),this.nativeRange.setStart(re,Ee)}R(this)},o.setEnd=function(re,Ee){try{this.nativeRange.setEnd(re,Ee)}catch{this.nativeRange.setStart(re,Ee),this.nativeRange.setEnd(re,Ee)}R(this)},Z=function(re,Ee){return function(be){try{this.nativeRange[re](be)}catch{this.nativeRange[Ee](be),this.nativeRange[re](be)}R(this)}}}o.setStartBefore=Z("setStartBefore","setEndBefore"),o.setStartAfter=Z("setStartAfter","setEndAfter"),o.setEndBefore=Z("setEndBefore","setStartBefore"),o.setEndAfter=Z("setEndAfter","setStartAfter"),o.selectNodeContents=function(W){this.setStartAndEnd(W,0,Y.getNodeLength(W))},F.selectNodeContents(te),F.setEnd(te,3);var de=document.createRange();de.selectNodeContents(te),de.setEnd(te,4),de.setStart(te,2),o.compareBoundaryPoints=-1==F.compareBoundaryPoints(F.START_TO_END,de)&&1==F.compareBoundaryPoints(F.END_TO_START,de)?function(W,re){return W==(re=re.nativeRange||re).START_TO_END?W=re.END_TO_START:W==re.END_TO_START&&(W=re.START_TO_END),this.nativeRange.compareBoundaryPoints(W,re)}:function(W,re){return this.nativeRange.compareBoundaryPoints(W,re.nativeRange||re)};var Ne=document.createElement("div");Ne.innerHTML="123";var ge=Ne.firstChild,Ue=Fe(document);Ue.appendChild(Ne),F.setStart(ge,1),F.setEnd(ge,2),F.deleteContents(),"13"==ge.data&&(o.deleteContents=function(){this.nativeRange.deleteContents(),R(this)},o.extractContents=function(){var W=this.nativeRange.extractContents();return R(this),W}),Ue.removeChild(Ne),Ue=null,fe.isHostMethod(F,"createContextualFragment")&&(o.createContextualFragment=function(W){return this.nativeRange.createContextualFragment(W)}),Fe(document).removeChild(te),o.getName=function(){return"WrappedRange"},h.WrappedRange=b,h.createNativeRange=function(W){return(W=He(W,I,"createNativeRange")).createRange()}}(),h.features.implementsTextRange){var n=function(o,w,R,_,Z){var te=o.duplicate();te.collapse(R);var F=te.parentElement();if(Y.isOrIsAncestorOf(w,F)||(F=w),!F.canHaveHTML){var de=new oe(F.parentNode,Y.getNodeIndex(F));return{boundaryPosition:de,nodeInfo:{nodeIndex:de.offset,containerElement:de.node}}}var Ne=Y.getDocument(F).createElement("span");Ne.parentNode&&Y.removeNode(Ne);for(var ge,W,re,Ee,be,Ue=R?"StartToStart":"StartToEnd",_e=Z&&Z.containerElement==F?Z.nodeIndex:0,nt=F.childNodes.length,Ve=nt,Me=Ve;Me==nt?F.appendChild(Ne):F.insertBefore(Ne,F.childNodes[Me]),te.moveToElementText(Ne),0!=(ge=te.compareEndPoints(Ue,o))&&_e!=Ve;){if(-1==ge){if(Ve==_e+1)break;_e=Me}else Ve=Ve==_e+1?_e:Me;Me=Math.floor((_e+Ve)/2),F.removeChild(Ne)}if(be=Ne.nextSibling,-1==ge&&be&&we(be)){var rt;if(te.setEndPoint(R?"EndToStart":"EndToEnd",o),/[\r\n]/.test(be.data)){var Le=te.duplicate(),it=Le.text.replace(/\r\n/g,"\r").length;for(rt=Le.moveStart("character",it);-1==(ge=Le.compareEndPoints("StartToEnd",Le));)rt++,Le.moveStart("character",1)}else rt=te.text.length;Ee=new oe(be,rt)}else W=(_||!R)&&Ne.previousSibling,Ee=(re=(_||R)&&Ne.nextSibling)&&we(re)?new oe(re,0):W&&we(W)?new oe(W,W.data.length):new oe(F,Y.getNodeIndex(Ne));return Y.removeNode(Ne),{boundaryPosition:Ee,nodeInfo:{nodeIndex:Me,containerElement:F}}},r=function(o,w){var R,_,F,de,Z=o.offset,te=Y.getDocument(o.node),Ne=Fe(te).createTextRange(),ge=we(o.node);return ge?_=(R=o.node).parentNode:(R=Z<(de=o.node.childNodes).length?de[Z]:null,_=o.node),(F=te.createElement("span")).innerHTML="&#feff;",R?_.insertBefore(F,R):_.appendChild(F),Ne.moveToElementText(F),Ne.collapse(!w),_.removeChild(F),ge&&Ne[w?"moveStart":"moveEnd"]("character",Z),Ne};((V=function(o){this.textRange=o,this.refresh()}).prototype=new Ae(document)).refresh=function(){var o,w,R,_=function(o){var w=o.parentElement(),R=o.duplicate();R.collapse(!0);var _=R.parentElement();(R=o.duplicate()).collapse(!1);var Z=R.parentElement(),te=_==Z?_:Y.getCommonAncestor(_,Z);return te==w?te:Y.getCommonAncestor(w,te)}(this.textRange);!function(o){return 0==o.compareEndPoints("StartToEnd",o)}(this.textRange)?(o=(R=n(this.textRange,_,!0,!1)).boundaryPosition,w=n(this.textRange,_,!1,!1,R.nodeInfo).boundaryPosition):w=o=n(this.textRange,_,!0,!0).boundaryPosition,this.setStart(o.node,o.offset),this.setEnd(w.node,w.offset)},V.prototype.getName=function(){return"WrappedTextRange"},Ae.copyComparisonConstants(V);var f=function(o){if(o.collapsed)return r(new oe(o.startContainer,o.startOffset),!0);var w=r(new oe(o.startContainer,o.startOffset),!0),R=r(new oe(o.endContainer,o.endOffset),!1),_=Fe(Ae.getRangeDocument(o)).createTextRange();return _.setEndPoint("StartToStart",w),_.setEndPoint("EndToEnd",R),_};if(V.rangeToTextRange=f,V.prototype.toTextRange=function(){return f(this)},h.WrappedTextRange=V,!h.features.implementsDomRange||h.config.preferTextRange){var N=Function("return this;")();typeof N.Range>"u"&&(N.Range=V),h.createNativeRange=function(o){return o=He(o,I,"createNativeRange"),Fe(o).createTextRange()},h.WrappedRange=V}}h.createRange=function(o){return o=He(o,I,"createRange"),new h.WrappedRange(h.createNativeRange(o))},h.createRangyRange=function(o){return o=He(o,I,"createRangyRange"),new Ae(o)},fe.createAliasForDeprecatedMethod(h,"createIframeRange","createRange"),fe.createAliasForDeprecatedMethod(h,"createIframeRangyRange","createRangyRange"),h.addShimListener(function(o){var w=o.document;typeof w.createRange>"u"&&(w.createRange=function(){return h.createRange(w)}),w=o=null})}),S.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(h,I){h.config.checkSelectionRanges=!0;var Be,We,b="boolean",V="number",Y=h.dom,fe=h.util,oe=fe.isHostMethod,Ae=h.DomRange,Fe=h.WrappedRange,He=h.DOMException,we=Y.DomPosition,n=h.features,r="Control",f=Y.getDocument,N=Y.getBody,o=Ae.rangesEqual;function w(t){return"string"==typeof t?/^backward(s)?$/i.test(t):!!t}function R(t,d){if(t){if(Y.isWindow(t))return t;if(t instanceof Ke)return t.win;var x=Y.getContentDocument(t,I,d);return Y.getWindow(x)}return window}function Z(t){return R(t,"getDocSelection").document.selection}function te(t){var d=!1;return t.anchorNode&&(d=1==Y.comparePoints(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)),d}var F=oe(window,"getSelection"),de=fe.isHostObject(document,"selection");n.implementsWinGetSelection=F,n.implementsDocSelection=de;var Ne=de&&(!F||h.config.preferTextRange);if(Ne)Be=Z,h.isSelectionValid=function(t){var d=R(t,"isSelectionValid").document,x=d.selection;return"None"!=x.type||f(x.createRange().parentElement())==d};else{if(!F)return I.fail("Neither document.selection or window.getSelection() detected."),!1;Be=function _(t){return R(t,"getWinSelection").getSelection()},h.isSelectionValid=function(){return!0}}h.getNativeSelection=Be;var ge=Be();if(!ge)return I.fail("Native selection was null (possibly issue 138?)"),!1;var Ue=h.createNativeRange(document),W=N(document),re=fe.areHostProperties(ge,["anchorNode","focusNode","anchorOffset","focusOffset"]);n.selectionHasAnchorAndFocus=re;var Ee=oe(ge,"extend");n.selectionHasExtend=Ee;var be=typeof ge.rangeCount==V;n.selectionHasRangeCount=be;var _e=!1,nt=!0,Ve=Ee?function(t,d){var x=Ae.getRangeDocument(d),j=h.createRange(x);j.collapseToPoint(d.endContainer,d.endOffset),t.addRange(L(j)),t.extend(d.startContainer,d.startOffset)}:null;fe.areHostMethods(ge,["addRange","getRangeAt","removeAllRanges"])&&typeof ge.rangeCount==V&&n.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var d=t.rangeCount,x=d>1,j=[],ce=te(t),xe=0;xe<d;++xe)j[xe]=t.getRangeAt(xe);var je=Y.createTestElement(document,"",!1),qe=je.appendChild(document.createTextNode("\xa0\xa0\xa0")),Ge=document.createRange();if(Ge.setStart(qe,1),Ge.collapse(!0),t.removeAllRanges(),t.addRange(Ge),nt=1==t.rangeCount,t.removeAllRanges(),!x){var e=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(e&&parseInt(e[1])>=36)_e=!1;else{var u=Ge.cloneRange();Ge.setStart(qe,0),u.setEnd(qe,3),u.setStart(qe,2),t.addRange(Ge),t.addRange(u),_e=2==t.rangeCount}}for(Y.removeNode(je),t.removeAllRanges(),xe=0;xe<d;++xe)0==xe&&ce?Ve?Ve(t,j[xe]):(h.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(j[xe])):t.addRange(j[xe])}}(),n.selectionSupportsMultipleRanges=_e,n.collapsedNonEditableSelectionsSupported=nt;var rt,$e,Me=!1;function Le(t,d,x){var j=x?"end":"start",ce=x?"start":"end";t.anchorNode=d[j+"Container"],t.anchorOffset=d[j+"Offset"],t.focusNode=d[ce+"Container"],t.focusOffset=d[ce+"Offset"]}function v(t){t.anchorNode=t.focusNode=null,t.anchorOffset=t.focusOffset=0,t.rangeCount=0,t.isCollapsed=!0,t._ranges.length=0}function L(t){var d;return t instanceof Ae?((d=h.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),d.setStart(t.startContainer,t.startOffset)):t instanceof Fe?d=t.nativeRange:n.implementsDomRange&&t instanceof Y.getWindow(t.startContainer).Range&&(d=t),d}function ie(t){var d=t.getNodes();if(!function ue(t){if(!t.length||t[0]&&1!=t[0].nodeType)return!1;for(var d=1,x=t.length;d<x;++d)if(!Y.isAncestorOf(t[0],t[d]))return!1;return!0}(d))throw I.createError("getSingleElementFromRange: range "+t.inspect()+" did not consist of a single element");return d[0]}function Ie(t){return!!t&&typeof t.text<"u"}function Oe(t,d){var x=new Fe(d);t._ranges=[x],Le(t,x,!1),t.rangeCount=1,t.isCollapsed=x.collapsed}function ze(t){if(t._ranges.length=0,"None"==t.docSelection.type)v(t);else{var d=t.docSelection.createRange();if(Ie(d))Oe(t,d);else{t.rangeCount=d.length;for(var x,j=f(d.item(0)),ce=0;ce<t.rangeCount;++ce)(x=h.createRange(j)).selectNode(d.item(ce)),t._ranges.push(x);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,Le(t,t._ranges[t.rangeCount-1],!1)}}}function st(t,d){for(var x=t.docSelection.createRange(),j=ie(d),ce=f(x.item(0)),xe=N(ce).createControlRange(),je=0,qe=x.length;je<qe;++je)xe.add(x.item(je));try{xe.add(j)}catch{throw I.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}xe.select(),ze(t)}function Ke(t,d,x){this.nativeSelection=t,this.docSelection=d,this._ranges=[],this.win=x,this.refresh()}function ke(t){t.win=t.anchorNode=t.focusNode=t._ranges=null,t.rangeCount=t.anchorOffset=t.focusOffset=0,t.detached=!0}W&&oe(W,"createControlRange")&&(rt=W.createControlRange(),fe.areHostProperties(rt,["item","add"])&&(Me=!0)),n.implementsControlRange=Me,We=re?function(t){return t.anchorNode===t.focusNode&&t.anchorOffset===t.focusOffset}:function(t){return!!t.rangeCount&&t.getRangeAt(t.rangeCount-1).collapsed},oe(ge,"getRangeAt")?$e=function(t,d){try{return t.getRangeAt(d)}catch{return null}}:re&&($e=function(t){var d=f(t.anchorNode),x=h.createRange(d);return x.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),x.collapsed!==this.isCollapsed&&x.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),x}),Ke.prototype=h.selectionPrototype;var ot=[];function ft(t,d){for(var j,ce,x=ot.length;x--;)if(ce=(j=ot[x]).selection,"deleteAll"==d)ke(ce);else if(j.win==t)return"delete"==d?(ot.splice(x,1),!0):ce;return"deleteAll"==d&&(ot.length=0),null}var ht=function(t){if(t&&t instanceof Ke)return t.refresh(),t;var d=ft(t=R(t,"getNativeSelection")),x=Be(t),j=de?Z(t):null;return d?(d.nativeSelection=x,d.docSelection=j,d.refresh()):(d=new Ke(x,j,t),ot.push({win:t,selection:d})),d};h.getSelection=ht,fe.createAliasForDeprecatedMethod(h,"getIframeSelection","getSelection");var lt,he=Ke.prototype;function dt(t,d){for(var xe,x=f(d[0].startContainer),j=N(x).createControlRange(),ce=0,je=d.length;ce<je;++ce){xe=ie(d[ce]);try{j.add(xe)}catch{throw I.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}j.select(),ze(t)}if(!Ne&&re&&fe.areHostMethods(ge,["removeAllRanges","addRange"])){he.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),v(this)};var ut=function(t,d){Ve(t.nativeSelection,d),t.refresh()};he.addRange=be?function(t,d){if(Me&&de&&this.docSelection.type==r)st(this,t);else if(w(d)&&Ee)ut(this,t);else{var x;_e?x=this.rangeCount:(this.removeAllRanges(),x=0);var j=L(t).cloneRange();try{this.nativeSelection.addRange(j)}catch{}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==x+1){if(h.config.checkSelectionRanges){var ce=$e(this.nativeSelection,this.rangeCount-1);ce&&!o(ce,t)&&(t=new Fe(ce))}this._ranges[this.rangeCount-1]=t,Le(this,t,ct(this.nativeSelection)),this.isCollapsed=We(this)}else this.refresh()}}:function(t,d){w(d)&&Ee?ut(this,t):(this.nativeSelection.addRange(L(t)),this.refresh())},he.setRanges=function(t){if(Me&&de&&t.length>1)dt(this,t);else{this.removeAllRanges();for(var d=0,x=t.length;d<x;++d)this.addRange(t[d])}}}else{if(!(oe(ge,"empty")&&oe(Ue,"select")&&Me&&Ne))return I.fail("No means of selecting a Range or TextRange was found"),!1;he.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var t;if(this.anchorNode)t=f(this.anchorNode);else if(this.docSelection.type==r){var d=this.docSelection.createRange();d.length&&(t=f(d.item(0)))}t&&(N(t).createTextRange().select(),this.docSelection.empty())}}catch{}v(this)},he.addRange=function(t){this.docSelection.type==r?st(this,t):(h.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,Le(this,t,!1))},he.setRanges=function(t){this.removeAllRanges();var d=t.length;d>1?dt(this,t):d&&this.addRange(t[0])}}if(he.getRangeAt=function(t){if(t<0||t>=this.rangeCount)throw new He("INDEX_SIZE_ERR");return this._ranges[t].cloneRange()},Ne)lt=function(t){var d;h.isSelectionValid(t.win)?d=t.docSelection.createRange():(d=N(t.win.document).createTextRange()).collapse(!0),t.docSelection.type==r?ze(t):Ie(d)?Oe(t,d):v(t)};else if(oe(ge,"getRangeAt")&&typeof ge.rangeCount==V)lt=function(t){if(Me&&de&&t.docSelection.type==r)ze(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var d=0,x=t.rangeCount;d<x;++d)t._ranges[d]=new h.WrappedRange(t.nativeSelection.getRangeAt(d));Le(t,t._ranges[t.rangeCount-1],ct(t.nativeSelection)),t.isCollapsed=We(t)}else v(t)};else{if(!re||typeof ge.isCollapsed!=b||typeof Ue.collapsed!=b||!n.implementsDomRange)return I.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;lt=function(t){var d,x=t.nativeSelection;x.anchorNode?(d=$e(x,0),t._ranges=[d],t.rangeCount=1,function it(t){var d=t.nativeSelection;t.anchorNode=d.anchorNode,t.anchorOffset=d.anchorOffset,t.focusNode=d.focusNode,t.focusOffset=d.focusOffset}(t),t.isCollapsed=We(t)):v(t)}}he.refresh=function(t){var d=t?this._ranges.slice(0):null,x=this.anchorNode,j=this.anchorOffset;if(lt(this),t){var ce=d.length;if(ce!=this._ranges.length||this.anchorNode!=x||this.anchorOffset!=j)return!0;for(;ce--;)if(!o(d[ce],this._ranges[ce]))return!0;return!1}};var ct,gt=function(t,d){var x=t.getAllRanges();t.removeAllRanges();for(var j=0,ce=x.length;j<ce;++j)o(d,x[j])||t.addRange(x[j]);t.rangeCount||v(t)};function pt(t,d){if(t.win.document!=f(d))throw new He("WRONG_DOCUMENT_ERR")}function vt(t){return function(d,x){var j;this.rangeCount?(j=this.getRangeAt(0))["set"+(t?"Start":"End")](d,x):(j=h.createRange(this.win.document)).setStartAndEnd(d,x),this.setSingleRange(j,this.isBackward())}}function mt(t){var d=[],x=new we(t.anchorNode,t.anchorOffset),j=new we(t.focusNode,t.focusOffset),ce="function"==typeof t.getName?t.getName():"Selection";if(typeof t.rangeCount<"u")for(var xe=0,je=t.rangeCount;xe<je;++xe)d[xe]=Ae.inspect(t.getRangeAt(xe));return"["+ce+"(Ranges: "+d.join(", ")+")(anchor: "+x.inspect()+", focus: "+j.inspect()+"]"}he.removeRange=Me&&de?function(t){if(this.docSelection.type==r){for(var d=this.docSelection.createRange(),x=ie(t),j=f(d.item(0)),ce=N(j).createControlRange(),je=!1,qe=0,Ge=d.length;qe<Ge;++qe)d.item(qe)!==x||je?ce.add(d.item(qe)):je=!0;ce.select(),ze(this)}else gt(this,t)}:function(t){gt(this,t)},!Ne&&re&&n.implementsDomRange?(ct=te,he.isBackward=function(){return ct(this)}):ct=he.isBackward=function(){return!1},he.isBackwards=he.isBackward,he.toString=function(){for(var t=[],d=0,x=this.rangeCount;d<x;++d)t[d]=""+this._ranges[d];return t.join("")},he.collapse=function(t,d){pt(this,t);var x=h.createRange(t);x.collapseToPoint(t,d),this.setSingleRange(x),this.isCollapsed=!0},he.collapseToStart=function(){if(!this.rangeCount)throw new He("INVALID_STATE_ERR");var t=this._ranges[0];this.collapse(t.startContainer,t.startOffset)},he.collapseToEnd=function(){if(!this.rangeCount)throw new He("INVALID_STATE_ERR");var t=this._ranges[this.rangeCount-1];this.collapse(t.endContainer,t.endOffset)},he.selectAllChildren=function(t){pt(this,t);var d=h.createRange(t);d.selectNodeContents(t),this.setSingleRange(d)},he.deleteFromDocument=function(){if(Me&&de&&this.docSelection.type==r){for(var d,t=this.docSelection.createRange();t.length;)d=t.item(0),t.remove(d),Y.removeNode(d);this.refresh()}else if(this.rangeCount){var x=this.getAllRanges();if(x.length){this.removeAllRanges();for(var j=0,ce=x.length;j<ce;++j)x[j].deleteContents();this.addRange(x[ce-1])}}},he.eachRange=function(t,d){for(var x=0,j=this._ranges.length;x<j;++x)if(t(this.getRangeAt(x)))return d},he.getAllRanges=function(){var t=[];return this.eachRange(function(d){t.push(d)}),t},he.setSingleRange=function(t,d){this.removeAllRanges(),this.addRange(t,d)},he.callMethodOnEachRange=function(t,d){var x=[];return this.eachRange(function(j){x.push(j[t].apply(j,d||[]))}),x},he.setStart=vt(!0),he.setEnd=vt(!1),h.rangePrototype.select=function(t){ht(this.getDocument()).setSingleRange(this,t)},he.changeEachRange=function(t){var d=[],x=this.isBackward();this.eachRange(function(j){t(j),d.push(j)}),this.removeAllRanges(),x&&1==d.length?this.addRange(d[0],"backward"):this.setRanges(d)},he.containsNode=function(t,d){return this.eachRange(function(x){return x.containsNode(t,d)},!0)||!1},he.getBookmark=function(t){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[t])}},he.moveToBookmark=function(t){for(var j,ce,d=[],x=0;j=t.rangeBookmarks[x++];)(ce=h.createRange(this.win)).moveToBookmark(j),d.push(ce);t.backward?this.setSingleRange(d[0],"backward"):this.setRanges(d)},he.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},he.restoreRanges=function(t){this.removeAllRanges();for(var x,d=0;x=t.ranges[d];++d)this.addRange(x,t.backward&&0==d)},he.toHtml=function(){var t=[];return this.eachRange(function(d){t.push(Ae.toHtml(d))}),t.join("")},n.implementsTextRange&&(he.getNativeTextRange=function(){var t;if(t=this.docSelection){var x=t.createRange();if(Ie(x))return x;throw I.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return h.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw I.createError("getNativeTextRange: selection contains no range")}),he.getName=function(){return"WrappedSelection"},he.inspect=function(){return mt(this)},he.detach=function(){ft(this.win,"delete"),ke(this)},Ke.detachAll=function(){ft(null,"deleteAll")},Ke.inspect=mt,Ke.isDirectionBackward=w,h.Selection=Ke,h.selectionPrototype=he,h.addShimListener(function(t){typeof t.getSelection>"u"&&(t.getSelection=function(){return ht(t)}),t=null})});var Xe=!1,Ze=function(h){Xe||(Xe=!0,!S.initialized&&S.config.autoInitialize&&s())};return ye&&("complete"==document.readyState?Ze():($(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",Ze,!1),E(window,"load",Ze))),S},this),function(q,se){"function"==typeof define&&define.amd?define(["./rangy-core"],q):typeof module<"u"&&"object"==typeof exports?module.exports=q(require("rangy")):q(se.rangy)}(function(q){return q.createModule("ClassApplier",["WrappedSelection"],function(se,K){var J=se.dom,g=J.DomPosition,H=J.arrayContains,pe=se.util,$=pe.forEach,z=pe.isHostMethod(document,"createElementNS");function Te(n,r){for(var f in n)if(n.hasOwnProperty(f)&&!1===r(f,n[f]))return!1;return!0}function k(n){return n.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function y(n,r){return!!n&&new RegExp("(?:^|\\s)"+r+"(?:\\s|$)").test(n)}function U(n,r){return"object"==typeof n.classList?n.classList.contains(r):y("string"==typeof n.className?n.className:n.getAttribute("class"),r)}function ne(n,r){if(/\s+/.test(r))for(var f=r.split(/\s+/),N=0,o=f.length;N<o;++N)ne(n,f[N]);else if("object"==typeof n.classList)n.classList.add(r);else{var w="string"==typeof n.className,R=w?n.className:n.getAttribute("class");R?y(R,r)||(R+=" "+r):R=r,w?n.className=R:n.setAttribute("class",R)}}var ee=function(){function n(r,f,N){return f&&N?" ":""}return function(r,f){if("object"==typeof r.classList)r.classList.remove(f);else{var N="string"==typeof r.className,o=N?r.className:r.getAttribute("class");o=o.replace(new RegExp("(^|\\s)"+f+"(\\s|$)"),n),N?r.className=o:r.setAttribute("class",o)}}}();function Ce(n){return"string"==typeof n.className?n.className:n.getAttribute("class")}function Se(n){return n&&n.split(/\s+/).sort().join(" ")}function ye(n){return Se(Ce(n))}function le(n,r){return ye(n)==ye(r)}function S(n,r){for(var f=r.split(/\s+/),N=0,o=f.length;N<o;++N)if(!U(n,k(f[N])))return!1;return!0}function C(n,r,f,N){-1==f&&(f=r.childNodes.length);var o=n.parentNode,w=J.getNodeIndex(n);$(N,function(R){!function l(n,r,f,N,o){var w=n.node,R=n.offset,_=w,Z=R;w==N&&R>o&&++Z,w==r&&(R==f||R==f+1)&&(_=N,Z+=o-f),w==r&&R>f+1&&--Z,n.node=_,n.offset=Z}(R,o,w,r,f)}),r.childNodes.length==f?r.appendChild(n):r.insertBefore(n,r.childNodes[f])}function a(n,r){var f=n.parentNode,N=J.getNodeIndex(n);$(r,function(o){!function m(n,r,f){n.node==r&&n.offset>f&&--n.offset}(o,f,N)}),J.removeNode(n)}function p(n,r){return function E(n,r,f,N,o){for(var w,R=[];w=n.firstChild;)C(w,r,f++,o),R.push(w);return N&&a(n,o),R}(n,n.parentNode,J.getNodeIndex(n),!0,r)}function A(n,r){var f=n.cloneRange();f.selectNodeContents(r);var N=f.intersection(n);return""!=(N?N.toString():"")}function s(n,r){for(var o,f=n.getNodes([3],r),N=0;(o=f[N])&&!A(n,o);)++N;for(var w=f.length-1;(o=f[w])&&!A(n,o);)--w;return f.slice(N,w+1)}function P(n,r){if(n.attributes.length!=r.attributes.length)return!1;for(var o,w,R,f=0,N=n.attributes.length;f<N;++f)if("class"!=(R=(o=n.attributes[f]).name)&&(null===o!=(null===(w=r.attributes.getNamedItem(R)))||o.specified!=w.specified||o.specified&&o.nodeValue!==w.nodeValue))return!1;return!0}function O(n,r){for(var o,f=0,N=n.attributes.length;f<N;++f)if(o=n.attributes[f].name,(!r||!H(r,o))&&n.attributes[f].specified&&"class"!=o)return!0;return!1}var D=J.getComputedStyleProperty,X="boolean"==typeof document.createElement("div").isContentEditable?function(r){return r&&1==r.nodeType&&r.isContentEditable}:function(r){return!(!r||1!=r.nodeType||"false"==r.contentEditable)&&("true"==r.contentEditable||X(r.parentNode))};function Pe(n){var r;return n&&1==n.nodeType&&((r=n.parentNode)&&9==r.nodeType&&"on"==r.designMode||X(n)&&!X(n.parentNode))}function De(n){return(X(n)||1!=n.nodeType&&X(n.parentNode))&&!Pe(n)}var Je=/^inline(-block|-table)?$/i;function tt(n){return n&&1==n.nodeType&&!Je.test(D(n,"display"))}var Xe=/[^\r\n\t\f \u200B]/;function h(n){var f,N,r=[];for(f=0;N=n[f++];)r.push(new g(N.startContainer,N.startOffset),new g(N.endContainer,N.endOffset));return r}function I(n,r){for(var o,w,f=0,R=n.length;f<R;++f)n[f].setStartAndEnd((o=r[2*f]).node,o.offset,(w=r[2*f+1]).node,w.offset)}function V(n,r,f,N){var o,w,R=0==f;if(J.isAncestorOf(r,n))return n;if(J.isCharacterDataNode(r)){var _=J.getNodeIndex(r);if(0==f)f=_;else{if(f!=r.length)throw K.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+f+" in "+r.data);f=_+1}r=r.parentNode}if(function b(n,r){return J.isCharacterDataNode(n)?0==r?!!n.previousSibling:r!=n.length||!!n.nextSibling:r>0&&r<n.childNodes.length}(r,f)){o=r.cloneNode(!1),w=r.parentNode,o.id&&o.removeAttribute("id");for(var Z,te=0;Z=r.childNodes[f];)C(Z,o,te++,N);return C(o,w,J.getNodeIndex(r)+1,N),r==n?o:V(n,w,J.getNodeIndex(o),N)}if(n!=r){o=r.parentNode;var F=J.getNodeIndex(r);return R||F++,V(n,o,F,N)}return n}function fe(n){var r=n?"nextSibling":"previousSibling";return function(f,N){var o=f.parentNode,w=f[r];if(w){if(w&&3==w.nodeType)return w}else if(N&&(w=o[r])&&1==w.nodeType&&function Y(n,r){return n.namespaceURI==r.namespaceURI&&n.tagName.toLowerCase()==r.tagName.toLowerCase()&&le(n,r)&&P(n,r)&&"inline"==D(n,"display")&&"inline"==D(r,"display")}(o,w)){var R=w[n?"firstChild":"lastChild"];if(R&&3==R.nodeType)return R}return null}}var oe=fe(!1),Ae=fe(!0);function Fe(n){this.isElementMerge=n&&1==n.nodeType,this.textNodes=[];var r=this.isElementMerge?n.lastChild:n;r&&(this.textNodes[0]=r)}Fe.prototype={doMerge:function(n){var r=this.textNodes,f=r[0];if(r.length>1){var _,N=J.getNodeIndex(f),o=[],w=0;$(r,function(Z,te){_=Z.parentNode,te>0&&(_.removeChild(Z),_.hasChildNodes()||J.removeNode(_),n&&$(n,function(F){F.node==Z&&(F.node=f,F.offset+=w),F.node==_&&F.offset>N&&(--F.offset,F.offset==N+1&&te<len-1&&(F.node=f,F.offset=w))})),o[te]=Z.data,w+=Z.data.length}),f.data=o.join("")}return f.data},getLength:function(){for(var n=this.textNodes.length,r=0;n--;)r+=this.textNodes[n].length;return r},toString:function(){var n=[];return $(this.textNodes,function(r,f){n[f]="'"+r.data+"'"}),"[Merge("+n.join(",")+")]"}};var He=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate","nodeFilter","elementPostProcessCallback"],we={};function Be(n,r,f){var N,o,w,R,_=this;_.cssClass=_.className=n;var Z=null,te={};if("object"==typeof r&&null!==r){for(typeof r.elementTagName<"u"&&(r.elementTagName=r.elementTagName.toLowerCase()),f=r.tagNames,Z=r.elementProperties,te=r.elementAttributes,o=0;R=He[o++];)r.hasOwnProperty(R)&&(_[R]=r[R]);N=r.normalize}else N=r;_.normalize=typeof N>"u"||N,_.attrExceptions=[];var F=document.createElement(_.elementTagName);_.elementProperties=_.copyPropertiesToElement(Z,F,!0),Te(te,function(Ne,ge){_.attrExceptions.push(Ne),te[Ne]=""+ge}),_.elementAttributes=te,_.elementSortedClassName=_.elementProperties.hasOwnProperty("className")?Se(_.elementProperties.className+" "+n):n,_.applyToAnyTagName=!1;var de=typeof f;if("string"==de)"*"==f?_.applyToAnyTagName=!0:_.tagNames=k(f.toLowerCase()).split(/\s*,\s*/);else if("object"==de&&"number"==typeof f.length)for(_.tagNames=[],o=0,w=f.length;o<w;++o)"*"==f[o]?_.applyToAnyTagName=!0:_.tagNames.push(f[o].toLowerCase());else _.tagNames=[_.elementTagName]}Be.prototype={elementTagName:"span",elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(n,r,f){var N,o,R,_,Z,te,w={};for(var F in n)if(n.hasOwnProperty(F))if(_=n[F],Z=r[F],"className"==F)ne(r,_),ne(r,this.className),r[F]=Se(r[F]),f&&(w[F]=_);else if("style"==F){for(N in o=Z,f&&(w[F]=R={}),n[F])n[F].hasOwnProperty(N)&&(o[N]=_[N],f&&(R[N]=o[N]));this.attrExceptions.push(F)}else r[F]=_,f&&(w[F]=r[F],te=we.hasOwnProperty(F)?we[F]:F,this.attrExceptions.push(te));return f?w:""},copyAttributesToElement:function(n,r){for(var f in n)n.hasOwnProperty(f)&&!/^class(?:Name)?$/i.test(f)&&r.setAttribute(f,n[f])},appliesToElement:function(n){return H(this.tagNames,n.tagName.toLowerCase())},getEmptyElements:function(n){var r=this;return n.getNodes([1],function(f){return r.appliesToElement(f)&&!f.hasChildNodes()})},getNonTextElements:function(n){return n.getNodes([1],function(f){return/img|svg|iframe|audio|video/i.test(f.tagName.toLowerCase())})},hasClass:function(n){return n&&1==n.nodeType&&(this.applyToAnyTagName||this.appliesToElement(n))&&U(n,this.className)},getSelfOrAncestorWithClass:function(n){for(;n;){if(this.hasClass(n))return n;n=n.parentNode}return null},isModifiable:function(n){return!this.applyToEditableOnly||De(n)},isIgnorableWhiteSpaceNode:function(n){return this.ignoreWhiteSpace&&n&&3==n.nodeType&&function Ze(n){if(0==n.data.length)return!0;if(Xe.test(n.data))return!1;switch(D(n.parentNode,"whiteSpace")){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(n.data))return!1}return tt(n.previousSibling)||tt(n.nextSibling)}(n)},postApply:function(n,r,f,N){var _,ge,o=n[0],w=n[n.length-1],R=[],Z=o,te=w,F=0,de=w.length;$(n,function(W){(ge=oe(W,!N))?(_||(_=new Fe(ge),R.push(_)),_.textNodes.push(W),W===o&&(F=(Z=_.textNodes[0]).length),W===w&&(te=_.textNodes[0],de=_.getLength())):_=null});var Ue=Ae(w,!N);if(Ue&&(_||(_=new Fe(w),R.push(_)),_.textNodes.push(Ue)),R.length){for(i=0,len=R.length;i<len;++i)R[i].doMerge(f);r.setStartAndEnd(Z,F,te,de)}},createContainer:function(n){var r=J.getDocument(n),N=z&&!J.isHtmlNamespace(n)&&n.namespaceURI?r.createElementNS(n.namespaceURI,this.elementTagName):r.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,N,!1),this.copyAttributesToElement(this.elementAttributes,N),ne(N,this.className),this.onElementCreate&&this.onElementCreate(N,this),N},elementHasProperties:function(n,r){var f=this;return Te(r,function(N,o){if("className"==N)return S(n,o);if("object"==typeof o){if(!f.elementHasProperties(n[N],o))return!1}else if(n[N]!==o)return!1})},elementHasAttributes:function(n,r){return Te(r,function(f,N){if(n.getAttribute(f)!==N)return!1})},applyToTextNode:function(n,r,f,N){if(function c(n){var r=n.parentNode;return r&&1==r.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(r.nodeName)}(n)){var o=n.parentNode;if(1==o.childNodes.length&&this.useExistingElements&&this.appliesToElement(o)&&this.elementHasProperties(o,this.elementProperties)&&this.elementHasAttributes(o,this.elementAttributes))ne(o,this.className);else{var w=n.parentNode;o=this.createContainer(w),w.insertBefore(o,n),o.appendChild(n)}this.elementPostProcessCallback&&this.elementPostProcessCallback(o,f,N)}},isRemovable:function(n){return n.tagName.toLowerCase()==this.elementTagName&&ye(n)==this.elementSortedClassName&&this.elementHasProperties(n,this.elementProperties)&&!O(n,this.attrExceptions)&&this.elementHasAttributes(n,this.elementAttributes)&&this.isModifiable(n)},isEmptyContainer:function(n){var r=n.childNodes.length;return n&&1==n.nodeType&&this.isRemovable(n)&&(0==r||1==r&&this.isEmptyContainer(n.firstChild))},removeEmptyContainers:function(n){var r=this,f=n.getNodes([1],function(w){return r.isEmptyContainer(w)}),N=[n],o=h(N);$(f,function(w){a(w,o)}),I(N,o)},undoToTextNode:function(n,r,f,N){if(!r.containsNode(f)){var o=r.cloneRange();o.selectNode(f),o.isPointInRange(r.endContainer,r.endOffset)&&(V(f,r.endContainer,r.endOffset,N),r.setEndAfter(f)),o.isPointInRange(r.startContainer,r.startOffset)&&(f=V(f,r.startContainer,r.startOffset,N))}this.isRemovable(f)?p(f,N):ee(f,this.className)},splitAncestorWithClass:function(n,r,f){var N=this.getSelfOrAncestorWithClass(n);N&&V(N,n,r,f)},undoToAncestor:function(n,r){this.isRemovable(n)?p(n,r):ee(n,this.className)},applyToRange:function(n,r,f){var N=this,o=h((r=r||[])||[]);if(n.splitBoundariesPreservingPositions(o),f){var w=N.getNonTextElements(n);$(w,function(F){ne(F,N.className)})}N.removeEmptyElements&&N.removeEmptyContainers(n);var R=s(n,N.nodeFilter);if(R.length){var _=R.length-1;$(R,function(F,de){!N.isIgnorableWhiteSpaceNode(F)&&!N.getSelfOrAncestorWithClass(F)&&N.isModifiable(F)&&N.applyToTextNode(F,o,de,_)});var Z=R[R.length-1];n.setStartAndEnd(R[0],0,Z,Z.length),N.normalize&&N.postApply(R,n,o,!1),I(r,o)}var te=N.getEmptyElements(n);$(te,function(F){ne(F,N.className)})},applyToRanges:function(n){for(var r=n.length;r--;)this.applyToRange(n[r],n);return n},applyToSelection:function(n){var r=se.getSelection(n);r.setRanges(this.applyToRanges(r.getAllRanges()))},undoToRange:function(n,r){var f=this,N=h(r=r||[]);n.splitBoundariesPreservingPositions(N),f.removeEmptyElements&&f.removeEmptyContainers(n,N);var w,R,o=s(n,f.nodeFilter),_=o[o.length-1];if(o.length){f.splitAncestorWithClass(n.endContainer,n.endOffset,N),f.splitAncestorWithClass(n.startContainer,n.startOffset,N);for(var Z=0,te=o.length;Z<te;++Z)(R=f.getSelfOrAncestorWithClass(w=o[Z]))&&f.isModifiable(w)&&f.undoToAncestor(R,N);n.setStartAndEnd(o[0],0,_,_.length),f.normalize&&f.postApply(o,n,N,!0),I(r,N)}var F=f.getEmptyElements(n);$(F,function(de){ee(de,f.className)})},undoToRanges:function(n){for(var r=n.length;r--;)this.undoToRange(n[r],n);return n},undoToSelection:function(n){var r=se.getSelection(n),f=se.getSelection(n).getAllRanges();this.undoToRanges(f),r.setRanges(f)},isAppliedToRange:function(n){if(n.collapsed||""==n.toString())return!!this.getSelfOrAncestorWithClass(n.commonAncestorContainer);var r=n.getNodes([3]);if(r.length)for(var N,f=0;N=r[f++];)if(!this.isIgnorableWhiteSpaceNode(N)&&A(n,N)&&this.isModifiable(N)&&!this.getSelfOrAncestorWithClass(N))return!1;return!0},isAppliedToRanges:function(n){var r=n.length;if(0==r)return!1;for(;r--;)if(!this.isAppliedToRange(n[r]))return!1;return!0},isAppliedToSelection:function(n){var r=se.getSelection(n);return this.isAppliedToRanges(r.getAllRanges())},toggleRange:function(n){this.isAppliedToRange(n)?this.undoToRange(n):this.applyToRange(n)},toggleSelection:function(n){this.isAppliedToSelection(n)?this.undoToSelection(n):this.applyToSelection(n)},getElementsWithClassIntersectingRange:function(n){var r=[],f=this;return n.getNodes([3],function(N){var o=f.getSelfOrAncestorWithClass(N);o&&!H(r,o)&&r.push(o)}),r},detach:function(){}},Be.util={hasClass:U,addClass:ne,removeClass:ee,getClass:Ce,hasSameClasses:le,hasAllClasses:S,replaceWithOwnChildren:p,elementsHaveSameNonClassAttributes:P,elementHasNonClassAttributes:O,splitNodeAt:V,isEditableElement:X,isEditingHost:Pe,isEditable:De},se.CssClassApplier=se.ClassApplier=Be,se.createClassApplier=function We(n,r,f){return new Be(n,r,f)},pe.createAliasForDeprecatedMethod(se,"createCssClassApplier","createClassApplier",K)}),q},this),window.ePubAnnotation={version:"10.6.0"},function(q,se){function K(y,U){return(" "+y.className+" ").indexOf(" "+U+" ")>-1}function J(y,U){var ne=y&&y.nodeType===Node.TEXT_NODE;if(ne&&U){var ee=y.nodeValue;if(" "===(ee=ee&&ee.replace(/[\u0020\t]{2,}/g," ").replace(/(\u0020*\n\u0020*)+/g," "))||""===ee)return!1}return ne}function g(y){return y&&y.nodeType===Node.ELEMENT_NODE}function H(y){return!!(q.Highlighter&&q.Highlighter.globalBaseClass&&g(y)&&"MARK"===y.tagName.toUpperCase()&&K(y,q.Highlighter.globalBaseClass)||K(y,q.ttsClasses.utteranceIgnorableClass)||K(y,q.utils.ignorableClassName))}function z(y){return se.getSelection(y)}q.utils={isTextNode:J,isElementNode:g,containingElement:function Re(y){for(var U=y;U&&1!==U.nodeType;)U=U.parentNode;return U},getActiveSelection:z,clearSelection:function Te(y){var U=z(y);U&&U.removeAllRanges()},hasClass:K,firstNonIgnorableParent:function $(y){for(var U=y;U&&H(U);)U=U.parentElement;return U},isIgnorable:H,isSkippable:function pe(y){if(!J(y)&&!g(y))return!0;if(!y.tagName||"SPAN"!==y.tagName.toUpperCase()&&"DIV"!==y.tagName.toUpperCase())return!1;if("MathJax_Message"===y.id||K(y,q.utils.skippableClassName))return!0;var U=!1;if(["MathJax_Preview","MathJax_SVG_Display","MathJax_SVG"].forEach(function(Ce){K(y,Ce)&&(U=!0)}),U)return!0;if("DIV"===y.tagName.toUpperCase())for(var ee=0;ee<y.childNodes.length;ee++)if("MathJax_SVG_Hidden"===y.childNodes[ee].id)return!0;return!1},detectIE:function k(){var y=window.navigator.userAgent;return y.indexOf("MSIE")>-1||y.indexOf("Trident/")>-1},ignorableClassName:"mhe-annotations-ignorable",skippableClassName:"mhe-annotations-skippable"}}(window.ePubAnnotation,window.rangy),function(q,se){function K(){return!1}function J(g,H){this.isIgnorable=g||K,this.isSkippable=H||K}J.prototype.getFirstChildNode=function(g){return(g=g.firstChild)&&this.isIgnorable(g)?this.getFirstChildNode(g):g&&this.isSkippable(g)?this.getNextNodeSibling(g):g},J.prototype.getLastChildNode=function(g){return(g=g.lastChild)&&this.isIgnorable(g)?this.getLastChildNode(g):g&&this.isSkippable(g)?this.getPrevNodeSibling(g):g},J.prototype.getParentNode=function(g){for(;g&&g.parentNode;)if(!this.isIgnorable(g=g.parentNode))return g},J.prototype.getNextNodeSibling=function(g,H){for(var pe,$=g&&se.isTextNode(g),Re=!H,z=!1;g;){if(pe=g.parentNode,(g=g.nextSibling)&&this.isIgnorable(g)&&(g=this.getFirstChildNode(g))&&(pe=g.parentNode,z=!0),g&&this.isSkippable(g)&&(g=this.getNextNodeSibling(g))&&(pe=g.parentNode,z=!0),g){if(Re&&z&&$&&se.isTextNode(g)){z=!1;continue}return g}!g&&pe&&this.isIgnorable(pe)&&(g=pe,z=!0)}},J.prototype.getPrevNodeSibling=function(g,H){for(var pe,$=se.isTextNode(g),Re=!H,z=!1;g;){if(pe=g.parentNode,(g=g.previousSibling)&&this.isIgnorable(g)&&(g=this.getLastChildNode(g))&&(pe=g.parentNode,z=!0),g&&this.isSkippable(g)&&(g=this.getPrevNodeSibling(g))&&(pe=g.parentNode,z=!0),g){if(Re&&z&&$&&se.isTextNode(g)){z=!1;continue}return g}!g&&pe&&this.isIgnorable(pe)&&(g=pe,z=!0)}},J.prototype.getNextElementSibling=function(g){for(g=this.getNextNodeSibling(g);g&&!se.isElementNode(g);)g=this.getNextNodeSibling(g);return g},J.prototype.getPrevElementSibling=function(g){for(g=this.getPrevNodeSibling(g);g&&!se.isElementNode(g);)g=this.getPrevNodeSibling(g);return g},J.prototype.getNextTextNodeSibling=function(g,H){for(g=this.getNextNodeSibling(g,H);g&&!se.isTextNode(g);)g=this.getNextNodeSibling(g,H);return g},J.prototype.getFirstChildElement=function(g){for(g=this.getFirstChildNode(g);g;){if(se.isElementNode(g))return g;g=this.getNextNodeSibling(g)}},J.prototype.firstChildIsElement=function(g){return!!(g=this.getFirstChildNode(g))&&se.isElementNode(g)},J.prototype.nextSiblingIsElement=function(g){return!!(g=this.getNextNodeSibling(g))&&se.isElementNode(g)},q.NodeTraversal=J}(window.ePubAnnotation,window.ePubAnnotation.utils),function(q,se,K){q.cfi={generateBasePath:le,lastParentIdFromCFIString:function c(a){var E=/\[([^\]]+)\]/g,p=a.split("!")[1];if(!p)return null;var A=p.match(E);return A&&A.length?E.exec([A[A.length-1]])[1]:null},spineIndexFromCFIString:function l(a){var p=U((a=z(a)).split("!")[0]);return p.length?p[p.length-1].index/2-1:null},spineIdFromCFIString:function m(a){var p=U((a=z(a)).split("!")[0]);return p.length?p[p.length-1].id:null},cfiStringFromSpineIndex:function S(a,E){return["epubcfi(",le(2,a,E),"!/4/1:0",")"].join("")},cfiStringFromNode:function C(a,E){for(;a;)if(H.isIgnorable(a))a=H.getFirstChildNode(a);else{if(!H.isSkippable(a))break;a=H.getNextNodeSibling(a)}if(!a)throw new Error("cfiStringFromNode failed to find legal starting node");return new ee(a).createCFIString(E)},cfiStringFromRange:function Se(a,E){for(var p=new ee(a.startContainer,a.startOffset),A=new ee(a.endContainer,a.endOffset),s=[];0!==p.path.length&&0!==A.path.length&&p.path[0].index===A.path[0].index;)s.push(p.path.shift()),A.path.shift();var O=[Ce(s),p.createCFISuffix(),A.createCFISuffix()].join(",");return Re(O=$(O,E))},rangeFromCFIString:function ye(a,E){var p=E||document,A=(a=function pe(a){return a.split("!")[1]}(a=z(a))).split(","),s=p.createRange();if(3===A.length){var O=A[0]+A[2],D=new ee(A[0]+A[1]),X=new ee(O);D.setRangeStart(s,p),X.setRangeEnd(s,p)}else if(1===A.length){var Pe=new ee(A[0]);Pe.setRangeStart(s,p),Pe.setRangeEnd(s,p)}return s},legacy:{},getVersion:function g(a){if(!a)return q.cfi;var E=q.cfi.legacy[a];if(!E)throw new Error(J+a);return E}};var J="Unknown legacy annotation lib version requested:";q.isLegacyVersionError=function(a){return a.message&&-1!==a.message.indexOf(J)};var H=new se(K.isIgnorable,K.isSkippable);function $(a,E){return E+"!"+a}function Re(a){return"epubcfi("+a+")"}function z(a){return 0===a.indexOf("epubcfi(")&&")"===a[a.length-1]?a.slice(8,a.length-1):a}function Te(a,E,p){for(var A=H.getFirstChildElement(E),s=a.index-2;A&&s>0;)A=H.getNextElementSibling(A),s-=2;return A}function k(a,E,p){var A=E,s=a.index-1;if(0===s)return H.firstChildIsElement(A)?H.getFirstChildElement(A):H.getFirstChildNode(A);for(H.firstChildIsElement(A)?(s-=2,A=H.getFirstChildElement(A)):A=H.getFirstChildNode(A);A&&s>0;)A=H.getNextElementSibling(A),s-=2;return H.nextSiblingIsElement(A)?H.getNextElementSibling(A):H.getNextTextNodeSibling(A)||H.getPrevElementSibling(A)||H.getParentNode(A)}function U(a){var E=a.match(/(\/[^:\/]+)/g);return E?E.map(function(A){var s=parseInt(A.substring(1),10),P=A.match(/\[(.+)\]/);return{type:s%2==0?"element":"text",id:P&&P[1],index:s}}):[]}function ee(a,E){if(this.path=[],this.charOffset=0,a&&a.nodeName){var p=a;p=this._consumeCharCount(p,E),p=this._consumeTextPath(p),this._consumeElementPath(p)}else"string"==typeof a&&(this.path=U(a),this.charOffset=function ne(a){return parseInt(a.split(":")[1])}(a))}function Ce(a){return a.map(function(E){return"/"+E.index+(E.id?"["+E.id+"]":"")}).join("")}function le(a,E,p){var A=["/",a=2*((a=parseInt(a))+1),"/",2*((E=parseInt(E))+1)].join("");return p&&(A=[A,"[",p,"]"].join("")),A}ee.prototype._consumeCharCount=function(a,E){var p=E||0,A=a;if(K.isElementNode(a)){if(void 0===E)return a;if(!(a=H.getFirstChildNode(a)))return A;for(var s=0;s<E;s++)a=H.getNextNodeSibling(a);return this.charOffset=0,a}for(;a&&(a=H.getPrevNodeSibling(a,!0))&&K.isTextNode(a);)p+=a.length,A=a;return this.charOffset=p,A},ee.prototype._consumeTextPath=function(a){if(K.isElementNode(a))return a;for(var E=1,p=a;a;)(a=H.getPrevElementSibling(a))&&(E+=2,p=a);return this.path.unshift({type:"text",index:E}),H.getParentNode(p)},ee.prototype._consumeElementPath=function(a){for(var E,A,p=a,s=0;p&&p.parentNode&&9!==p.parentNode.nodeType;){for(A=p.id,s=2,E=p;E;)(E=H.getPrevNodeSibling(E))&&K.isElementNode(E)&&(s+=2);this.path.unshift({type:"element",id:A,index:s}),p=H.getParentNode(p)}},ee.prototype.createCFISuffix=function(){var a=Ce(this.path);return(0===this.path.length||"text"===this.path[this.path.length-1].type)&&(a+=":"+this.charOffset),a.replace(/\[MathJax[^\]]*\]/,"")},ee.prototype.createCFIString=function(a){var E=this.createCFISuffix();return Re(E=$(E,a))},ee.prototype.getNode=function(a){return function y(a,E,p){for(var s,P=[],O=E||p.getElementsByTagName("html")[0],D=a.length-1;D>=0;D--){if((s=a[D]).id){O=p.getElementById(s.id);break}P.unshift(s)}for(;P.length>0;){if(!O)throw new Error("Bad CFI Path");"element"===(s=P.shift()).type?O=Te(s,O):"text"===s.type&&(O=k(s,O))}return O}(this.path,null,a)},ee.prototype.setRangeStart=function(a,E){var p=this.charOffset,A=this.getNode(E);if(K.isTextNode(A))for(;A&&p>A.length;)p-=A.length,A=H.getNextTextNodeSibling(A,!0);a.setStart(A,p)},ee.prototype.setRangeEnd=function(a,E){var p=this.charOffset,A=this.getNode(E);if(K.isTextNode(A))for(;A&&p>A.length;)p-=A.length,A=H.getNextTextNodeSibling(A,!0);a.setEnd(A,p)}}(window.ePubAnnotation,window.ePubAnnotation.NodeTraversal,window.ePubAnnotation.utils),function(q,se,K){q.cfi.legacy.v5={generateBasePath:Ce,lastParentIdFromCFIString:function ye(c){var l=/\[([^\]]+)\]/g,m=c.split("!")[1];if(!m)return null;var C=m.match(l);return C&&C.length?l.exec([C[C.length-1]])[1]:null},spineIndexFromCFIString:function le(c){var m=Te((c=Re(c)).split("!")[0]);return m.length?m[m.length-1].index/2-1:null},cfiStringFromSpineIndex:function Se(c,l){return["epubcfi(",Ce(2,c,l),"!/4/1:0",")"].join("")},cfiStringFromNode:function S(c,l){for(;c;)if(g.isIgnorable(c))c=g.getFirstChildNode(c);else{if(!g.isSkippable(c))break;c=g.getNextNodeSibling(c)}if(!c)throw new Error("cfiStringFromNode failed to find legal starting node");return new y(c).createCFIString(l)},cfiStringFromRange:function ne(c,l){for(var m=new y(c.startContainer,c.startOffset),C=new y(c.endContainer,c.endOffset),a=[];0!==m.path.length&&0!==C.path.length&&m.path[0].index===C.path[0].index;)a.push(m.path.shift()),C.path.shift();var p=[U(a),m.createCFISuffix(),C.createCFISuffix()].join(",");return $(p=pe(p,l))},rangeFromCFIString:function ee(c,l){var m=l||document,C=(c=function H(c){return c.split("!")[1]}(c=Re(c))).split(","),a=m.createRange();if(3===C.length){var p=C[0]+C[2],A=new y(C[0]+C[1]),s=new y(p);A.setRangeStart(a,m),s.setRangeEnd(a,m)}else if(1===C.length){var P=new y(C[0]);P.setRangeStart(a,m),P.setRangeEnd(a,m)}return a}};var g=new se(K.isIgnorable,function(c){if(!c.tagName||"SPAN"!==c.tagName.toUpperCase()&&"DIV"!==c.tagName.toUpperCase())return!1;if("MathJax_Message"===c.id)return!0;var l=!1;if(["MathJax_Preview","MathJax_SVG_Display"].forEach(function(a){K.hasClass(c,a)&&(l=!0)}),l)return!0;if("DIV"===c.tagName.toUpperCase())for(var C=0;C<c.childNodes.length;C++)if("MathJax_SVG_Hidden"===c.childNodes[C].id)return!0;return!1});function pe(c,l){return l+"!"+c}function $(c){return"epubcfi("+c+")"}function Re(c){return 0===c.indexOf("epubcfi(")&&")"===c[c.length-1]?c.slice(8,c.length-1):c}function Te(c){var l=c.match(/(\/[^:\/]+)/g);return l?l.map(function(C){var a=parseInt(C.substring(1),10),E=C.match(/\[(.+)\]/);return{type:a%2==0?"element":"text",id:E&&E[1],index:a}}):[]}function y(c,l){if(this.path=[],this.charOffset=0,c&&c.nodeName){var m=c;m=this._consumeCharCount(m,l),m=this._consumeTextPath(m),this._consumeElementPath(m)}else"string"==typeof c&&(this.path=Te(c),this.charOffset=function k(c){return parseInt(c.split(":")[1])}(c))}function U(c){return c.map(function(l){return"/"+l.index+(l.id?"["+l.id+"]":"")}).join("")}function Ce(c,l,m){var C=["/",c=2*((c=parseInt(c))+1),"/",2*((l=parseInt(l))+1)].join("");return m&&(C=[C,"[",m,"]"].join("")),C}y.prototype._consumeCharCount=function(c,l){var m=l||0,C=c;if(K.isElementNode(c)){if(void 0===l)return c;if(!(c=g.getFirstChildNode(c)))return C;for(var a=0;a<l;a++)c=g.getNextNodeSibling(c);return this.charOffset=0,c}for(;c&&(c=g.getPrevNodeSibling(c,!0))&&K.isTextNode(c);)m+=c.length,C=c;return this.charOffset=m,C},y.prototype._consumeTextPath=function(c){if(K.isElementNode(c))return c;for(var l=1,m=c;c;)(c=g.getPrevNodeSibling(c))&&K.isTextNode(c)&&(l+=2,m=c);return this.path.unshift({type:"text",index:l}),g.getParentNode(m)},y.prototype._consumeElementPath=function(c){for(var l,C,m=c,a=0;m&&m.parentNode&&9!==m.parentNode.nodeType;){for(C=m.id,a=2,l=m;l;)(l=g.getPrevNodeSibling(l))&&K.isElementNode(l)&&(a+=2);this.path.unshift({type:"element",id:C,index:a}),m=g.getParentNode(m)}},y.prototype.createCFISuffix=function(){var c=U(this.path);return(0===this.path.length||"text"===this.path[this.path.length-1].type)&&(c+=":"+this.charOffset),c.replace(/\[MathJax[^\]]*\]/,"")},y.prototype.createCFIString=function(c){var l=this.createCFISuffix();return $(l=pe(l,c))},y.prototype.getNode=function(c){return function z(c,l,m){for(var C,a,E=[],p=l||m.getElementsByTagName("html")[0],A=c.length-1;A>=0;A--){if((a=c[A]).id){p=m.getElementById(a.id);break}E.unshift(a)}for(;E.length>0;){if(!p)throw new Error("Bad CFI Path");if("element"===(a=E.shift()).type)for(p=g.getFirstChildElement(p),C=a.index-2;p&&C>0;)p=g.getNextElementSibling(p),C-=2;else if("text"===a.type)for(K.isTextNode(p)||(p=g.getFirstChildNode(p))&&!K.isTextNode(p)&&(p=g.getNextTextNodeSibling(p)),C=a.index-1;p&&C>0;)p=g.getNextTextNodeSibling(p),C-=2}return p}(this.path,null,c)},y.prototype.setRangeStart=function(c,l){var m=this.charOffset,C=this.getNode(l);if(K.isTextNode(C))for(;C&&m>C.length;)m-=C.length,C=g.getNextTextNodeSibling(C,!0);c.setStart(C,m)},y.prototype.setRangeEnd=function(c,l){var m=this.charOffset,C=this.getNode(l);if(K.isTextNode(C))for(;C&&m>C.length;)m-=C.length,C=g.getNextTextNodeSibling(C,!0);c.setEnd(C,m)}}(window.ePubAnnotation,window.ePubAnnotation.NodeTraversal,window.ePubAnnotation.utils),function(q,se,K){q.cfi.legacy.v6={generateBasePath:m,lastParentIdFromCFIString:function a(s){var P=/\[([^\]]+)\]/g,O=s.split("!")[1];if(!O)return null;var D=O.match(P);return D&&D.length?P.exec([D[D.length-1]])[1]:null},spineIndexFromCFIString:function E(s){var O=Se((s=U(s)).split("!")[0]);return O.length?O[O.length-1].index/2-1:null},spineIdFromCFIString:function p(s){var O=Se((s=U(s)).split("!")[0]);return O.length?O[O.length-1].id:null},cfiStringFromSpineIndex:function C(s,P){return["epubcfi(",m(2,s,P),"!/4/1:0",")"].join("")},cfiStringFromNode:function A(s,P){for(;s;)if(z.isIgnorable(s))s=z.getFirstChildNode(s);else{if(!z.isSkippable(s))break;s=z.getNextNodeSibling(s)}if(!s)throw new Error("cfiStringFromNode failed to find legal starting node");return new le(s).createCFIString(P)},cfiStringFromRange:function c(s,P){for(var O=new le(s.startContainer,s.startOffset),D=new le(s.endContainer,s.endOffset),X=[];0!==O.path.length&&0!==D.path.length&&O.path[0].index===D.path[0].index;)X.push(O.path.shift()),D.path.shift();var De=[S(X),O.createCFISuffix(),D.createCFISuffix()].join(",");return y(De=k(De,P))},rangeFromCFIString:function l(s,P){var O=P||document,D=(s=function Te(s){return s.split("!")[1]}(s=U(s))).split(","),X=O.createRange();if(3===D.length){var De=D[0]+D[2],Je=new le(D[0]+D[1]),tt=new le(De);Je.setRangeStart(X,O),tt.setRangeEnd(X,O)}else if(1===D.length){var Xe=new le(D[0]);Xe.setRangeStart(X,O),Xe.setRangeEnd(X,O)}return X},getVersion:function Re(s){if(!s)return q.cfi;var P=q.cfi.legacy[s];if(!P)throw new Error($+s);return P}};var $="Unknown legacy annotation lib version requested:";q.isLegacyVersionError=function(s){return s.message&&-1!==s.message.indexOf($)};var z=new se(K.isIgnorable,function pe(s){if(!function g(s){return s&&s.nodeType===Node.TEXT_NODE}(s)&&!function H(s){return s&&s.nodeType===Node.ELEMENT_NODE}(s))return!0;if(!s.tagName||"SPAN"!==s.tagName.toUpperCase()&&"DIV"!==s.tagName.toUpperCase())return!1;if("MathJax_Message"===s.id)return!0;var P=!1;if(["MathJax_Preview","MathJax_SVG_Display"].forEach(function(X){(function J(s,P){return(" "+s.className+" ").indexOf(" "+P+" ")>-1})(s,X)&&(P=!0)}),P)return!0;if("DIV"===s.tagName.toUpperCase())for(var D=0;D<s.childNodes.length;D++)if("MathJax_SVG_Hidden"===s.childNodes[D].id)return!0;return!1});function k(s,P){return P+"!"+s}function y(s){return"epubcfi("+s+")"}function U(s){return 0===s.indexOf("epubcfi(")&&")"===s[s.length-1]?s.slice(8,s.length-1):s}function ne(s,P,O){for(var D=z.getFirstChildElement(P),X=s.index-2;D&&X>0;)D=z.getNextElementSibling(D),X-=2;return D}function ee(s,P,O){var D=P,X=s.index-1;if(0===X)return z.firstChildIsElement(D)?z.getFirstChildElement(D):z.getFirstChildNode(D);for(z.firstChildIsElement(D)?(X-=2,D=z.getFirstChildElement(D)):D=z.getFirstChildNode(D);D&&X>0;)D=z.getNextElementSibling(D),X-=2;return z.nextSiblingIsElement(D)?z.getNextElementSibling(D):z.getNextTextNodeSibling(D)||z.getPrevElementSibling(D)||z.getParentNode(D)}function Se(s){var P=s.match(/(\/[^:\/]+)/g);return P?P.map(function(D){var X=parseInt(D.substring(1),10),Pe=D.match(/\[(.+)\]/);return{type:X%2==0?"element":"text",id:Pe&&Pe[1],index:X}}):[]}function le(s,P){if(this.path=[],this.charOffset=0,s&&s.nodeName){var O=s;O=this._consumeCharCount(O,P),O=this._consumeTextPath(O),this._consumeElementPath(O)}else"string"==typeof s&&(this.path=Se(s),this.charOffset=function ye(s){return parseInt(s.split(":")[1])}(s))}function S(s){return s.map(function(P){return"/"+P.index+(P.id?"["+P.id+"]":"")}).join("")}function m(s,P,O){var D=["/",s=2*((s=parseInt(s))+1),"/",2*((P=parseInt(P))+1)].join("");return O&&(D=[D,"[",O,"]"].join("")),D}le.prototype._consumeCharCount=function(s,P){var O=P||0,D=s;if(K.isElementNode(s)){if(void 0===P)return s;if(!(s=z.getFirstChildNode(s)))return D;for(var X=0;X<P;X++)s=z.getNextNodeSibling(s);return this.charOffset=0,s}for(;s&&(s=z.getPrevNodeSibling(s,!0))&&K.isTextNode(s);)O+=s.length,D=s;return this.charOffset=O,D},le.prototype._consumeTextPath=function(s){if(K.isElementNode(s))return s;for(var P=1,O=s;s;)(s=z.getPrevElementSibling(s))&&(P+=2,O=s);return this.path.unshift({type:"text",index:P}),z.getParentNode(O)},le.prototype._consumeElementPath=function(s){for(var P,D,O=s,X=0;O&&O.parentNode&&9!==O.parentNode.nodeType;){for(D=O.id,X=2,P=O;P;)(P=z.getPrevNodeSibling(P))&&K.isElementNode(P)&&(X+=2);this.path.unshift({type:"element",id:D,index:X}),O=z.getParentNode(O)}},le.prototype.createCFISuffix=function(){var s=S(this.path);return(0===this.path.length||"text"===this.path[this.path.length-1].type)&&(s+=":"+this.charOffset),s.replace(/\[MathJax[^\]]*\]/,"")},le.prototype.createCFIString=function(s){var P=this.createCFISuffix();return y(P=k(P,s))},le.prototype.getNode=function(s){return function Ce(s,P,O){for(var X,Pe=[],De=P||O.getElementsByTagName("html")[0],Je=s.length-1;Je>=0;Je--){if((X=s[Je]).id){De=O.getElementById(X.id);break}Pe.unshift(X)}for(;Pe.length>0;){if(!De)throw new Error("Bad CFI Path");"element"===(X=Pe.shift()).type?De=ne(X,De):"text"===X.type&&(De=ee(X,De))}return De}(this.path,null,s)},le.prototype.setRangeStart=function(s,P){var O=this.charOffset,D=this.getNode(P);if(K.isTextNode(D))for(;D&&O>D.length;)O-=D.length,D=z.getNextTextNodeSibling(D,!0);s.setStart(D,O)},le.prototype.setRangeEnd=function(s,P){var O=this.charOffset,D=this.getNode(P);if(K.isTextNode(D))for(;D&&O>D.length;)O-=D.length,D=z.getNextTextNodeSibling(D,!0);s.setEnd(D,O)}}(window.ePubAnnotation,window.ePubAnnotation.NodeTraversal,window.ePubAnnotation.utils),function(q){function se($,Re,z){var Te=this;Te.name=$,Te.color=Re,Te.displayText=z,Te.classes=$+"-highlight",Te.selectClasses="colorSelect "+$,Te.menuClasses=$}var J=[new se("yellow","#FFF098","Yellow Highlight"),new se("blue","#BDD7FC","Blue Highlight"),new se("green","#CFFF53","Green Highlight"),new se("pink","#FFBEDC","Pink Highlight")],g=J.map(function K($){return{aria:$.displayText,classes:$.selectClasses,menuClasses:$.menuClasses,highlight:$}});q.colorData={colors:J,highlightDefaults:{shape:"epr-shape-square-filled",color:J[0].classes},colorInfoArray:g,getColorInfoForClass:function pe($){for(var Re=0;Re<g.length;++Re)if(g[Re].highlight.classes===$)return g[Re]}}}(window.ePubAnnotation),function(q,se,K,J,g){q.createFromSelection=function ye(l,m,C,a){var E=J.getActiveSelection(l);if(function pe(l,m,C){if(!l||l.rangeCount<1)return!0;if(C)return!1;var a=l.getRangeAt(0),E=ne(new se.WrappedRange(a),m);return!!/^\s*$/.test(E)}(E,l,a))return null;var p=new se.WrappedRange(E.getRangeAt(0));return{cfi:K.getVersion(C).cfiStringFromRange(p,m),text:Ce(ne(p,l),H)}},q.editAnnotation=function S(l,m,C){var a=l.hasNote&&l.noteText;if(l.highlight||a||l.placemark||l.shape){var p=l.selection;return function le(l){l.highlight&&!l.shape&&(l.shape=g.highlightDefaults.shape)}(p),void 0===p.color&&(p.color=g.highlightDefaults.color),p.highlight=!!l.highlight,l.color&&(p.color=l.color.highlight.classes),a?p.note=l.noteText:delete p.note,l.placemark?p.placemarkText=function Se(l,m,C){var a=c(l,m,C),E=J.containingElement(a.startContainer),p=J.containingElement(a.endContainer);if((E=J.firstNonIgnorableParent(E))!==(p=J.firstNonIgnorableParent(p))||!E)return Ce(ne(a,m),H);var s=se.createRange(m),P=ne(a,m);s.setStart(E,0),s.setEnd(a.startContainer,a.startOffset);var O=ne(s,m).length,D=O+P.length,X=E.cloneNode(!0);$(X,m);var Pe=X.textContent,De=Pe.length;if(D-O>100)return Ce(P,H);var tt=O,Xe=O+100;Xe>De&&(Xe=De,tt=Math.max(0,Xe-100));var Ze=Pe.slice(tt,Xe);return tt>0&&(Ze=O===tt?"..."+Ze:Ze.replace(/^\S*\s/,"...")),Xe<De&&(Ze=Ze.replace(/\s\S*$/,"...")),Ze}(l.selection,m,C):delete p.placemarkText,l.shape&&(p.shape=l.shape,p.highlight=!0),p.clientModifiedAt=(new Date).toISOString(),p.modifiedBy=l.platformId||"_",void 0===p.clientCreatedAt&&(p.clientCreatedAt=p.clientModifiedAt,p.createdBy=p.modifiedBy),p}},q.getRangeForAnnotation=c,q.textForRange=ne,q.htmlForRange=function ee(l,m){var C=y(l,m),a=m.createElement("div");return a.appendChild(C.cloneNode(!0)),a.innerHTML};var H=3500;function $(l,m){if(function Re(l,m){var C=["mhe-inline-credit","mhe-user-select-none","mhe-tts-ignore"],a=C.concat(["student","mhe-user-select-none-on-instructor"]),E=C.concat(["teacher","instructor","acme-teacher","mhe-user-select-none-on-learner"]);if(l.classList){if(m.body.classList.contains("mhe-context-view-instructor")&&z(l,a))return!0;if(m.body.classList.contains("mhe-context-view-learner")&&z(l,E))return!0}return!!(l.tagName&&["svg","script"].indexOf(l.tagName.toLowerCase())>-1)}(l,m))l.parentNode&&l.parentNode.removeChild(l);else{!function k(l){for(var m=0;m<l.childNodes.length;m++)l.childNodes[m]&&8===l.childNodes[m].nodeType&&(l.childNodes[m].textContent="")}(l);for(var C=function Te(l){for(var m=[],C=0;C<l.childNodes.length;C++)l.childNodes[C]&&1===l.childNodes[C].nodeType&&m.push(l.childNodes[C]);return m}(l),a=0;a<C.length;a++)$(C[a],m)}}function z(l,m){for(var C=0,a=m.length;C<a;C++)if(l.classList.contains(m[C]))return!0;return!1}function y(l,m){var C=l.cloneContents();return $(C,m),C}function U(l){var C="";switch(l.tagName?l.tagName.toUpperCase():void 0){case"IMG":C=l.alt;break;case"IFRAME":case"SVG":case"BR":break;default:if(!l.hasChildNodes())return l.textContent;for(var a=l.childNodes,E=[],p=0;p<a.length;p++)E.push(U(a[p]));C=E.filter(function(A){return""!==A}).join(" ")}return C}function ne(l,m){var a=U(y(l,m))||"";return a.replace(/[\u0020\t]{2,}/g," ").replace(/(\u0020*\n\u0020*)+/g,"\n")}function Ce(l,m){var C=l.length;return C>m&&(l=[l.slice(0,m/2),l.slice(C-m/2)].join("...\n\n...")),l}function c(l,m,C){var a=K.getVersion(C).rangeFromCFIString(l.cfi,m);return new se.WrappedRange(a)}}(window.ePubAnnotation,window.rangy,window.ePubAnnotation.cfi,window.ePubAnnotation.utils,window.ePubAnnotation.colorData),function(q,se,K,J){var g="mhe-global-annotation";function H(k){this.scopedClass=k||"annotation",this.highlightClass="highlight",this.noteClass="note",this.placemarkClass="placemark",this.commentClass="highlight-comment",this.lrClass="has-lr",this.clickableClass="clickable",this.nonClickableClass="not-clickable"}function pe(k){var U=K.containingElement(k),ne=U&&U.tagName.toLowerCase();if(ne&&-1!==["annotation","math","svg"].indexOf(ne))return!1;var Ce=U.parentElement&&U.parentElement.namespaceURI;return!(Ce&&-1!==["http://www.w3.org/2000/svg","http://www.w3.org/1998/Math/MathML"].indexOf(Ce))}function $(k){if(k){if(3===k.nodeType)for(;k.nextSibling&&3===k.nextSibling.nodeType;)k.nodeValue+=k.nextSibling.nodeValue,k.parentNode.removeChild(k.nextSibling);else $(k.firstChild);$(k.nextSibling)}}function Re(k,y){var U=!!y&&y.parentNode;U&&(y.outerHTML=y.innerHTML,K.detectIE()?$(U):U.normalize())}function z(k,y,U){var ne=k.getElementsByClassName(y);if(ne&&(!ne||ne.length)){if(U)for(var Ce=(y+=" "+["highlight","placemark","note","mhe-global-annotation","epr-shape-square-filled","epr-shape-square-outline","epr-shape-round-outline","epr-shape-underline"].join(" ")).split(" "),Se=Array.prototype.slice.apply(ne).filter(function(c){return"MARK"!==c.tagName.toUpperCase()}),ye=0,le=Se.length;ye<le;ye++)Ce.forEach(function(c){Se[ye].classList.remove(c)});for(var S=Array.prototype.slice.apply(ne).filter(function(c){return"MARK"===c.tagName.toUpperCase()});S.length>0;)Re(0,S.pop())}}H.prototype.getMarkClassesForAnnotation=function(k){var y=[g,this.scopedClass];return k.note&&y.push(this.noteClass),k.highlight&&(k.shape||y.push(J.highlightDefaults.shape),y.push(this.highlightClass)),k.color&&y.push(k.color),k.placemarkText&&y.push(this.placemarkClass),k.shape&&y.push(k.shape),this.hasComment(k)&&(y.push(this.commentClass),k.commentColor&&y.push(k.commentColor+"-comment")),k.hasLR&&y.push(this.lrClass),!1===k.clickable?y.push(this.nonClickableClass):!0===k.clickable&&y.push(this.clickableClass),k.platform&&y.push(k.platform),y},H.prototype.setBaseCFI=function(k){this.baseCFIString=k},H.prototype.addMarksForAnnotation=function(k,y,U,ne,ee,Ce){if(!function Te(k,y){if(void 0===y.baseCFIString)return!1;var U=q.cfi.spineIdFromCFIString(k.cfi),ne=q.cfi.spineIdFromCFIString(y.baseCFIString);return U?U===ne:q.cfi.spineIndexFromCFIString(k.cfi)===q.cfi.spineIndexFromCFIString(y.baseCFIString)}(k,this))return!0;try{var Se=Ce||"$id",ye=this.getMarkClassesForAnnotation(k).join(" "),le=this.scopedClass,S=le+"-id-"+k[Se]+" "+ye+" highlight-element",c={"data-highlight-id":k[Se],"data-highlight-index":y,tabindex:0};(!1===k.clickable||!1===k.focusable)&&delete c.tabindex;var l={ignoreWhiteSpace:!0,elementTagName:"mark",tagNames:[],elementAttributes:c,elementProperties:{className:ye},nodeFilter:pe,elementPostProcessCallback:function(a,E,p){"MARK"!==a.tagName.toUpperCase()&&a.classList.remove(g),E===p&&0===p?(a.classList.add(le+"-start-end"),a.id=k[Se]):0===E?(a.classList.add(le+"-start"),a.id=k[Se]):a.classList.add(E===p?le+"-end":le+"-middle")}};ee&&(l.tagNames=["svg","img","iframe","audio","video"]),this.hasComment(k)&&(l.elementAttributes["data-comments"]=k.comments);var m=se.createClassApplier(S,l),C=q.getRangeForAnnotation(k,U,ne);return m.applyToRange(C,null,ee),!0}catch(a){if(q.isLegacyVersionError(a))throw a;return!1}},H.prototype.removeMarksForAnnotation=function(k,y,U,ne){if(y&&k){var ee=this.getMarkClassesForAnnotation(y);ee.push(this.scopedClass+"-id-"+y[ne||"$id"]),ee.sort(),z(k,ee.join(" "),U)}},H.prototype.removeAllMarks=function(y,U){z(y,this.scopedClass,U)},H.prototype.hasComment=function(k){return!(!(k.comments&&parseInt(k.comments)>0)||isNaN(k.comments))},H.prototype.isAnnotation=function(y){return y&&y.classList&&y.classList.contains(this.scopedClass)},H.prototype.getAnnotationForElement=function(k,y,U){var ne=U||"$id";if(this.isAnnotation(k)){var Ce=new RegExp(this.scopedClass+"-id-([^ ]+)"),ye=(k.className.baseVal||k.className||"").match(Ce),le=ye&&ye[1];return le&&function ee(S,c){for(var l=0,m=c.length;l<m;++l)if(c[l][ne]===S)return c[l]}(le,y)}},H.prototype.getSelectedAnnotation=function(k,y,U){for(var ne=k.target;ne&&!this.isAnnotation(ne);)ne=ne.parentElement;return this.getAnnotationForElement(ne,y,U)},q.Highlighter=H,q.Highlighter.globalBaseClass=g}(window.ePubAnnotation,window.rangy,window.ePubAnnotation.utils,window.ePubAnnotation.colorData),function(q,se,K,J){var H={breakList:["P","H1","H2","H3","H4","H5","H6","LI","FIGCAPTION","IMG","IFRAME","PRE"],specialHTMLElements:["DETAILS"],utteranceIgnorableClass:"tts-utterance-ignorable",activeUtteranceClass:"tts-active",utteranceDataAttr:"data-tts-utterance",utterances:[]};function pe(S,c){$(S);var l=S.querySelector("body");return l&&Te(l)&&y(l,S,c),H.utterances}function $(S){if(H.utterances=[],S){for(var c=S.querySelectorAll("["+H.utteranceDataAttr+"]"),l=0;l<c.length;l++)c[l].removeAttribute(H.utteranceDataAttr);for(var m=S.querySelectorAll("."+H.activeUtteranceClass),C=0;C<m.length;C++)m[C].classList.remove(H.activeUtteranceClass);for(var E=S.querySelectorAll("."+H.utteranceIgnorableClass),p=0;p<E.length;p++){var A=E[p],s=S.createTextNode(A.textContent);A.parentElement.replaceChild(s,A)}var P=S.querySelector("#tts-utterance-marker");P&&P.parentElement.removeChild(P)}}function Te(S){for(var c=S.children,l=0;l<c.length;l++){var m=c[l];if(H.breakList.indexOf(m.tagName.toUpperCase())>=0)return!0;if(m.children.length>0&&Te(m))return!0}return!1}function y(S,c,l){function m(s){return s&&s.tagName&&s.tagName.toUpperCase()}if(H.specialHTMLElements.indexOf(m(S))>=0&&"DETAILS"===m(S))!function k(S,c,l){S.childNodes.forEach(function(m){U(m,c,l,!1)})}(S,c,l);else{var C=[].slice.call(S.childNodes,0).some(function(s){return H.specialHTMLElements.indexOf(m(s))>=0});if(H.breakList.indexOf(m(S))>=0&&!C)U(S,c,l);else for(var a=S.childNodes,E=0;E<a.length;E++){var p=a[E];3===p.nodeType&&""!==ee(p.textContent)&&(p=Ce(p,c)),1===p.nodeType&&(Te(p)?y(p,c,l):U(p,c,l))}}}function U(S,c,l,m){var C=!0;void 0!==m&&(C=m);var a=function ne(S,c){var l=c.createRange();return l.selectNode(S),ee(q.textForRange(l,c))}(S,c);if(""!==a&&(!C||function Se(S){return!!window.__karma__||!!(S.offsetWidth||S.offsetHeight||S.getClientRects().length)}(S))){var E;if(S.childNodes.length>0){var p=c.createRange();p.setStart(S.firstChild,0),p.setEnd(S.lastChild,S.lastChild.length),E=l&&J.cfiStringFromRange(p,l)}else E=l&&J.cfiStringFromNode(S,l);S.setAttribute("data-tts-utterance",H.utterances.length),H.utterances.push({text:a,html:S.outerHTML,cfi:E})}}function ee(S){return S.replace(/[\n\r]/g," ").replace(/\s+/g," ").trim()}function Ce(S,c){var l=c.createElement("span");return l.setAttribute("class",H.utteranceIgnorableClass),S.parentNode.insertBefore(l,S),l.appendChild(S),l}function ye(S,c){var l=S.getElementById("tts-utterance-marker");l||((l=S.createElement("div")).setAttribute("id","tts-utterance-marker"),l.setAttribute("class",H.utteranceIgnorableClass),S.body.appendChild(l));var m=c.clientHeight,C=le(c);l.style.height=m+"px",l.style.top=C+"px"}function le(S,c){return S&&S.offsetParent?(c=(c||0)+S.offsetTop,"body"===S.offsetParent.tagName.toLowerCase()?c:le(S.offsetParent,c)):0}q.ttsClasses={utteranceIgnorableClass:H.utteranceIgnorableClass,activeUtteranceClass:H.activeUtteranceClass},q.createTextUtteranceArray=function z(S,c){return pe(S,c)},q.processUtterances=pe,q.setActiveUtterance=function Re(S,c){for(var l=null,m=0;m<H.utterances.length;m++){var C=c.querySelector('[data-tts-utterance="'+S+'"]');C&&(m===S?(l=C,C.classList.add("tts-active"),ye(c,C)):C.classList.remove("tts-active"))}return l},q.removeUtterances=$}(window.ePubAnnotation,window,window,window.ePubAnnotation.cfi);